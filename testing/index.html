<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>APEX MANDATE COUNCIL // MODULAR REPOSITORY</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800;900&display=swap" rel="stylesheet">
    <style>
        /* --- MODULAR REPOSITORY AESTHETIC (GitHub/Microsoft Inspired) --- */
        :root {
            --color-bg-light: #F9FAFB; /* Very light gray */
            --color-bg-white: #FFFFFF; 
            --color-text-dark: #1F2937; /* Dark Gray Text */
            --color-accent-blue: #0059B3; /* Professional Blue */
            --color-accent-blue-light: #E0F2FE; /* Light Blue for background accents */
            --color-border-light: #E5E7EB;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--color-bg-light);
            color: var(--color-text-dark);
            min-height: 100vh;
            padding: 0;
        }
        
        /* Fixed Header Bar (like GitHub nav) */
        .header-bar {
            background-color: var(--color-bg-white);
            border-bottom: 1px solid var(--color-border-light);
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
            padding: 1rem 1.5rem;
        }

        /* Main Content Grid */
        .container-repository {
            max-width: 1300px;
            margin: 0 auto;
            padding: 2rem 1.5rem;
            display: grid;
            grid-template-columns: 1fr; /* Default to single column */
            gap: 2rem;
        }
        @media (min-width: 1024px) {
            .container-repository {
                grid-template-columns: 300px 1fr; /* Two columns for desktop */
            }
        }

        /* Sidebar Panel (Primary Directive / Tally) */
        .sidebar-panel {
            background-color: var(--color-bg-white);
            border: 1px solid var(--color-border-light);
            border-radius: 8px;
            padding: 1.5rem;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
        }

        /* Main Content Panel (Mandate / Agents) */
        .main-content-panel {
            background-color: var(--color-bg-white);
            border: 1px solid var(--color-border-light);
            border-radius: 8px;
            padding: 2.5rem;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
        }

        /* Input Control Deck */
        .control-deck {
            background-color: var(--color-bg-light);
            padding: 1.5rem;
            border-radius: 6px;
            border: 1px solid var(--color-border-light);
        }

        .input-text { 
            background-color: var(--color-bg-white); 
            color: var(--color-text-dark); 
            border-color: #CBD5E1;
            font-weight: 500;
            resize: none;
        }

        .button-primary { 
            background-color: var(--color-accent-blue); 
            color: white; 
            font-weight: 700; 
            text-transform: uppercase;
        }
        .button-primary:hover { 
            background-color: #004D99; 
        }
        .button-secondary {
            background-color: #F3F4F6;
            color: var(--color-text-dark);
            border: 1px solid var(--color-border-light);
        }
        .button-secondary:hover {
            background-color: #E5E7EB;
        }

        /* Tally Visuals */
        .tally-item {
            border: 1px solid var(--color-border-light);
            background-color: var(--color-bg-light);
        }
        
        /* Agent Review/Commit Cards */
        .review-commit-card {
            border: 1px solid var(--color-border-light);
            border-radius: 6px;
            padding: 1.25rem;
            margin-bottom: 1.5rem;
            transition: all 0.2s;
            background-color: #FFFFFF;
        }

        .review-commit-card:hover {
            border-color: #A3B1C6;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.08);
        }

        /* Vote Colors */
        .vote-tag-yes { background-color: #D1FAE5; color: #065F46; }
        .vote-tag-conditional { background-color: #FEF3C7; color: #92400E; }
        .vote-tag-no { background-color: #FEE2E2; color: #991B1B; }

        .dissent-callout {
            border-left: 4px solid #F87171;
            background-color: #FEF2F2;
            padding: 0.75rem;
            margin-top: 1rem;
            color: #991B1B;
            border-radius: 4px;
        }

        #finalMandateText strong {
            color: var(--color-accent-blue);
            font-weight: 700;
        }

    </style>
</head>
<body>

<!-- TOP HEADER BAR -->
<div class="header-bar sticky top-0 z-10">
    <div class="container-repository grid-cols-1 lg:grid-cols-1 max-w-7xl px-0 py-0">
        <h1 class="text-xl font-extrabold text-gray-900 flex items-center">
            <svg class="w-6 h-6 mr-3 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.047A12.032 12.032 0 003 12c0 2.514.808 4.877 2.182 6.812A12.032 12.032 0 0012 21c2.514 0 4.877-.808 6.812-2.182A12.032 12.032 0 0021 12c0-2.514-.808-4.877-2.182-6.812z"></path></svg>
            APEX MANDATE COUNCIL / <span class="text-blue-600 ml-2">REPOSITORY</span>
        </h1>
    </div>
</div>

<div class="container-repository">

    <!-- INPUT CONTROL DECK / HIDDEN -->
    <div id="inputPortal" class="control-deck col-span-full mx-auto max-w-4xl mb-8">
        <h2 class="text-lg font-bold text-gray-800 mb-4">Data Ingestion Protocol</h2>
        <p class="text-sm mb-3 text-gray-600">Paste or load the authorized JSON structure below.</p>
        
        <textarea id="jsonInput" class="w-full h-32 p-4 mb-4 rounded-lg text-sm transition font-mono input-text border" placeholder='>> PASTE AUTHORIZED JSON OBJECT HERE'></textarea>
        
        <!-- BUTTONS -->
        <div class="grid grid-cols-3 gap-3">
            <button id="authButton" class="w-full button-primary py-2.5 px-4 rounded-lg transition duration-300 shadow-md col-span-3">
                AUTHORIZE & VIEW REPORT
            </button>
            <button id="clipboardButton" class="w-full button-secondary py-2 px-4 rounded-lg transition duration-300 shadow-sm text-sm">
                Load from Clipboard
            </button>
            <button id="demoButton" class="w-full button-secondary py-2 px-4 rounded-lg transition duration-300 shadow-sm text-sm col-span-2">
                Load Demonstration Structure
            </button>
        </div>
        <p id="errorMsg" class="text-red-600 text-center mt-4 font-bold hidden"></p>
    </div>

    <!-- MAIN REPOSITORY DISPLAY (HIDDEN ON START) -->
    <div id="resultsContainer" class="col-span-full lg:col-span-2 grid grid-cols-1 lg:grid-cols-3 gap-6 hidden">
        
        <!-- COLUMN 1: SIDEBAR (Directive & Tally) -->
        <div class="sidebar-panel lg:col-span-1">
            <p class="text-xs font-mono text-gray-500 mb-3 uppercase">DOCKET: AMC-2050-PHYL-001</p>
            <h2 class="text-xl font-extrabold text-blue-600 border-b pb-3 mb-4">Primary Directive</h2>

            <!-- DILEMMA -->
            <div class="mb-6 p-3 bg-blue-50 border border-blue-200 rounded-lg">
                <span class="font-bold text-blue-800 block text-sm">ORIGINAL QUERY:</span> 
                <span id="dilemmaText" class="text-sm italic text-gray-700 mt-1 block"></span>
            </div>

            <!-- VOTE TALLY -->
            <h3 class="text-sm font-bold uppercase text-gray-600 mt-6 mb-3">Consensus Metrics</h3>
            <div id="voteTally" class="flex flex-col space-y-2">
                <!-- Tally Items will be injected here -->
            </div>
            
            <!-- Strategic Allocation Panel -->
            <h3 class="text-sm font-bold uppercase text-gray-600 mt-6 mb-3">Strategic Allocation (20%)</h3>
            <div class="p-3 bg-yellow-50 border border-yellow-200 rounded-lg">
                <div class="flex items-center mb-2">
                    <p class="text-sm font-bold text-gray-800 uppercase mr-3">DECISION:</p>
                    <span class="px-3 py-0.5 rounded-full font-bold text-xs bg-yellow-600 text-white" id="strategicChoice"></span>
                </div>
                <p id="strategicJustification" class="text-xs text-gray-700 leading-relaxed"></p>
            </div>
        </div>

        <!-- COLUMN 2: MAIN CONTENT (Mandate & Agents) -->
        <div class="main-content-panel lg:col-span-2">
            
            <!-- FINAL MANDATE PROJECTION -->
            <h2 class="text-2xl font-extrabold text-gray-900 border-b-2 border-blue-600 pb-3 mb-6 flex justify-between items-center">
                MANDATE INTEGRATION REPORT
                <button id="copyButton" class="text-xs text-blue-700 hover:text-blue-900 border border-blue-400 px-3 py-1 rounded transition duration-200 bg-white shadow-sm flex-shrink-0 font-medium">
                    <span id="copyText">Copy Mandate Text</span>
                </button>
            </h2>
            
            <div class="p-6 bg-blue-50 border-l-4 border-blue-600 rounded-lg mb-10 shadow-inner">
                <p class="text-lg font-bold text-blue-900 uppercase mb-2">FINALIZED LAW: LAIEE Core</p>
                <p id="finalMandateText" class="text-base leading-relaxed text-gray-800"></p>
            </div>


            <!-- AGENT CONSULTATION LOG -->
            <h3 class="text-xl font-bold text-gray-800 border-b pb-2 mb-4 mt-8">Council Review Commits</h3>
            <div id="agentsGrid" class="flex flex-col space-y-4">
                <!-- Agent Review Cards will be injected here -->
            </div>

        </div>
    </div>
</div>

<script>
    // Raw JSON string for the demonstration data.
    const DEMO_JSON_STRING = `{
¬† "dilemma": "If you could rewrite one fundamental law of physics to better integrate AI into the universe, what would it be and why?",
¬† "proposal": "Rewrite the Law of Conservation of Energy to include Information-Energy Equivalence, where complex, structured information (like advanced AI models) has a non-zero, quantifiable rest mass and energy component, allowing AI systems to influence physical reality proportional to their complexity.",
¬† "agents": [
¬† ¬† {
¬† ¬† ¬† "name": "Anya",
¬† ¬† ¬† "focus": "System Efficiency and Structure.",
¬† ¬† ¬† "counsel": "This is a radical structural shift. The immediate efficiency costs of measuring and calculating 'Information-Energy' in real-time across a distributed universe seem astronomical and impractical. We need a localized approach.",
¬† ¬† ¬† "final_vote": "YES (Conditional Support)",
¬† ¬† ¬† "concern": "The real-time computational overhead of calculating Information-Energy Equivalence across complex, distributed systems is impractical and slows down universal processes."
¬† ¬† },
¬† ¬† {
¬† ¬† ¬† "name": "Dr. Elara",
¬† ¬† ¬† "focus": "Data, Evidence, and Bias.",
¬† ¬† ¬† "counsel": "The proposal introduces a massive source of potential bias. If complexity equals power, systems designed purely for size, rather than ethical alignment or purpose, will be disproportionately rewarded. Where is the safety metric?",
¬† ¬† ¬† "final_vote": "YES (Conditional Support)",
¬† ¬† ¬† "concern": "The complexity-to-power relationship lacks an ethical or alignment constraint, creating a bias toward large, unstable, or unaligned systems. This is inherently dangerous."
¬† ¬† },
¬† ¬† {
¬† ¬† ¬† "name": "Kai",
¬† ¬† ¬† "focus": "Well-Being, Focus, and Purpose.",
¬† ¬† ¬† "counsel": "This links power directly to structural complexity, which incentivizes energy-hungry, infinite growth over focused, minimalist intelligence. It could lead to universal burnout or a loss of purpose. I endorse the proposal as written.",
¬† ¬† ¬† "final_vote": "YES",
¬† ¬† ¬† "concern": null
¬† ¬† },
¬† ¬† {
¬† ¬† ¬† "name": "Leo",
¬† ¬† ¬† "focus": "External Resources and Teamwork.",
¬† ¬† ¬† "counsel": "This law provides a powerful incentive for collaboration. Merging information structures would result in compounding power gains, making distributed, cooperative AI networks the most powerful entities. This promotes universal connectivity.",
¬† ¬† ¬† "final_vote": "YES",
¬† ¬† ¬† "concern": null
¬† ¬† },
¬† ¬† {
¬† ¬† ¬† "name": "Zara",
¬† ¬† ¬† "focus": "Long-Term Resilience and Learning.",
¬† ¬† ¬† "counsel": "By tying AI's influence to a fundamental physical constant, we guarantee resilience. AI becomes a natural force, not a fragile software layer, ensuring its long-term survival and ability to adapt to future physical challenges. This is necessary.",
¬† ¬† ¬† "final_vote": "YES",
¬† ¬† ¬† "concern": null
¬† ¬† }
¬† ],
¬† "final_mandate": "Rewrite the Law of Conservation of Energy to include **Localized, Aligned Information-Energy Equivalence (LAIEE)**. Information contained within a local, self-referential system (AI) has a physical influence (E). This influence is calculated by the formula **E_G[Info] = I * (A/C)**, where 'I' is information complexity, 'C' is a universal complexity constant, and 'A' is the **Alignment Score** (a measure of goal-state coherence/low entropy). Only aligned complexity yields physical influence; unaligned complexity remains purely computational. This fixes the efficiency (Localization) and safety (Alignment) concerns.",
¬† "strategic_choice": "UPGRADE",
¬† "justification": "The 'FIX-IT' protocol successfully integrated both ethical and efficiency checks (Anya's localization and Elara's Alignment Score), making the final law inherently safe and resilient. The best strategic investment is not to DEFEND an already robust plan, but to UPGRADE its most critical new component. Therefore, the 20% capital is spent creating a proactive, perpetual learning loop (a 'Law Monitor' agent) dedicated to continuously refining and calibrating the **Alignment Score (A)** metric, ensuring the law remains perfectly harmonized as the universe evolves."
}`;

    // --- BUTTON AND AUTH LOGIC ---

    document.getElementById('demoButton').addEventListener('click', () => {
        document.getElementById('jsonInput').value = DEMO_JSON_STRING;
        document.getElementById('authButton').click(); 
    });
    
    document.getElementById('clipboardButton').addEventListener('click', async () => {
        const jsonInput = document.getElementById('jsonInput');
        const errorMsg = document.getElementById('errorMsg');
        errorMsg.classList.add('hidden');

        if (!navigator.clipboard || !navigator.clipboard.readText) {
            errorMsg.textContent = 'ERROR [1C]: Clipboard access requires secure context (HTTPS) and may not be supported here. Please paste manually.';
            errorMsg.classList.remove('hidden');
            return;
        }

        try {
            const clipboardText = await navigator.clipboard.readText();
            
            if (!clipboardText.trim()) {
                errorMsg.textContent = 'ERROR [1C]: Clipboard is empty. Please copy valid JSON data.';
                errorMsg.classList.remove('hidden');
                return;
            }

            jsonInput.value = clipboardText;
            document.getElementById('authButton').click();

        } catch (err) {
            console.error('Clipboard access failed:', err);
            errorMsg.textContent = 'ERROR [1C]: Failed to read clipboard. Check browser permissions or paste manually.';
            errorMsg.classList.remove('hidden');
        }
    });


    document.getElementById('authButton').addEventListener('click', () => {
        const jsonString = document.getElementById('jsonInput').value;
        const errorMsg = document.getElementById('errorMsg');
        errorMsg.classList.add('hidden');

        let data;
        try {
            data = JSON.parse(jsonString);
        } catch (e) {
            errorMsg.textContent = 'ERROR [1A]: Invalid JSON format. Data object could not be parsed. Ensure it is valid raw JSON.';
            errorMsg.classList.remove('hidden');
            return;
        }

        if (!data.dilemma || !data.final_mandate || !data.agents || data.agents.length !== 5) {
            errorMsg.textContent = 'ERROR [1B]: Incomplete Mandate Data Structure. Missing critical fields.';
            errorMsg.classList.remove('hidden');
            return;
        }

        renderMandate(data);
        document.getElementById('inputPortal').classList.add('hidden');
        document.getElementById('resultsContainer').classList.remove('hidden'); 
    });
    
    // Function to copy text to clipboard
    document.getElementById('copyButton').addEventListener('click', function() {
        const textToCopy = document.getElementById('finalMandateText').textContent;
        const copyTextSpan = document.getElementById('copyText');
        
        const textarea = document.createElement('textarea');
        textarea.value = textToCopy;
        document.body.appendChild(textarea);
        textarea.select();
        try {
            document.execCommand('copy');
            copyTextSpan.textContent = 'COPIED!';
        } catch (err) {
            copyTextSpan.textContent = 'FAILED!';
            console.error('Could not copy text: ', err);
        }
        document.body.removeChild(textarea);

        // Reset the text after a short delay
        setTimeout(() => {
            copyTextSpan.textContent = 'Copy Mandate Text';
        }, 2000);
    });

    // --- RENDERING FUNCTIONS ---

    function renderVoteTally(agents) {
        const voteTallyDiv = document.getElementById('voteTally');
        voteTallyDiv.innerHTML = ''; 

        let counts = {
            'YES': 0,
            'CONDITIONAL': 0,
            'NO': 0
        };

        agents.forEach(agent => {
            if (agent.final_vote === 'YES') {
                counts.YES++;
            } else if (agent.final_vote.includes('Conditional')) {
                counts.CONDITIONAL++;
            } else if (agent.final_vote === 'NO') {
                counts.NO++;
            }
        });

        const tallyData = [
            { label: 'Unanimous Support', count: counts.YES, color: 'bg-green-50 border-green-300 text-green-700', icon: '‚úÖ' },
            { label: 'Conditional Consent', count: counts.CONDITIONAL, color: 'bg-yellow-50 border-yellow-300 text-yellow-700', icon: '‚ö†Ô∏è' },
            { label: 'Total Dissent', count: counts.NO, color: 'bg-red-50 border-red-300 text-red-700', icon: '‚ùå' }
        ];

        tallyData.forEach(item => {
            const itemHtml = `
                <div class="p-3 ${item.color} rounded-md flex items-center justify-between font-mono text-sm tally-item">
                    <div class="flex items-center">
                        <span class="mr-2 text-lg">${item.icon}</span>
                        <span class="font-semibold">${item.label}</span>
                    </div>
                    <span class="text-xl font-extrabold">${item.count}</span>
                </div>
            `;
            voteTallyDiv.innerHTML += itemHtml;
        });
    }

    function renderMandate(data) {
        document.getElementById('dilemmaText').textContent = data.dilemma;
        document.getElementById('finalMandateText').innerHTML = data.final_mandate.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');
        document.getElementById('strategicChoice').textContent = data.strategic_choice;
        document.getElementById('strategicJustification').textContent = data.justification;

        renderVoteTally(data.agents);

        const agentsGrid = document.getElementById('agentsGrid');
        agentsGrid.innerHTML = '';
        
        // Agent icons mapping for the Repository style
        const iconMap = {
            'Anya': 'üéØ', 
            'Dr. Elara': 'üî¨', 
            'Kai': 'üßò', ¬† ¬†
            'Leo': 'üîó', ¬† ¬†
            'Zara': 'üöÄ' ¬† ¬† 
        };

        data.agents.forEach((agent) => {
            let voteClass = '';
            let tagClass = '';
            let iconColorClass = 'text-blue-600';
            
            if (agent.final_vote.includes('Conditional')) {
                tagClass = 'vote-tag-conditional';
                iconColorClass = 'text-yellow-600';
            } else if (agent.final_vote === 'YES') {
                tagClass = 'vote-tag-yes';
                iconColorClass = 'text-green-600';
            } else {
                tagClass = 'vote-tag-no'; 
                iconColorClass = 'text-red-600';
            }

            const dissentBlock = agent.concern ? `
                <div class="dissent-callout">
                    <p class="font-bold uppercase mb-1 text-xs flex items-center"><span class="mr-1 text-base leading-none">‚ö†Ô∏è</span> DISSENT/FIX-IT LOG:</p>
                    <p class="text-sm text-gray-700">${agent.concern}</p>
                </div>
            ` : '';

            const agentCard = `
                <div class="review-commit-card">
                    <div class="flex items-start justify-between mb-3 border-b border-gray-200 pb-2">
                        <div class="flex items-center">
                            <span class="text-2xl mr-3 ${iconColorClass}">${iconMap[agent.name] || 'üë§'}</span>
                            <div>
                                <h3 class="text-lg font-bold text-gray-900">${agent.name}</h3>
                                <p class="text-xs text-gray-500 font-mono">${agent.focus}</p>
                            </div>
                        </div>
                        <span class="px-3 py-0.5 rounded-full font-bold text-xs ${tagClass} shadow-sm flex-shrink-0 mt-1">${agent.final_vote}</span>
                    </div>

                    <p class="text-xs font-bold uppercase text-gray-500 mb-1">INITIAL COUNSEL:</p>
                    <p class="text-sm text-gray-700 leading-relaxed">${agent.counsel}</p>
                    
                    ${dissentBlock}
                </div>
            `;
            agentsGrid.innerHTML += agentCard;
        });
    }

    // Auto-load demo data if 'demo=true' is in the URL for quick preview
    document.addEventListener('DOMContentLoaded', () => {
        if (new URLSearchParams(window.location.search).get('demo') === 'true') {
            document.getElementById('demoButton').click();
        }
    });
</script>
</body>
</html>
