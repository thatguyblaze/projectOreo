<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>APEX MANDATE COUNCIL // OFFICIAL FEDERAL DOSSIER</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
    <style>
        /* Unified Federal Log Aesthetic: Single Column, High Clarity */
        :root {
            --color-primary-bg: #F0F3F7; /* Very light gray/blue for background */
            --color-secondary-bg: #FFFFFF; /* Main Panel Background (White) */
            --color-accent-blue: #002D62; /* Deep Federal Navy Blue (Primary) */
            --color-accent-red: #B00020; /* Authority Red */
            --color-text-dark: #1F2937; /* Dark Gray */
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--color-primary-bg);
            color: var(--color-text-dark);
            min-height: 100vh;
            padding: 2rem 1rem;
        }
        .container-dossier {
            max-width: 1200px; /* Slightly narrower content column */
            margin-left: auto;
            margin-right: auto;
            background-color: transparent;
        }
        
        /* Main Content Block Styling */
        .content-block {
            background-color: var(--color-secondary-bg);
            padding: 2.5rem;
            border-radius: 12px;
            border: 1px solid #E5E7EB;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
        }

        .title-official {
            letter-spacing: 0.1em;
            text-transform: uppercase;
            border-bottom: 4px solid var(--color-accent-blue);
            padding-bottom: 0.75rem;
            color: var(--color-accent-blue);
            font-weight: 800;
        }
        .section-header {
            font-weight: 700;
            color: var(--color-accent-blue);
            border-bottom: 1px solid #E5E7EB; 
            padding-bottom: 0.5rem;
            margin-top: 3rem;
            margin-bottom: 1.5rem;
        }

        /* Agent Card Styling */
        .agent-card-official {
            background-color: #F8FAFC; 
            border-radius: 8px;
            border: 1px solid #E2E8F0;
            transition: all 0.2s ease;
        }
        .agent-card-official:hover {
            border-color: var(--color-accent-blue); 
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.08);
        }

        /* Vote Colors & Badges */
        .vote-badge {
            font-weight: 700;
            padding: 0.4rem 1rem;
            border-radius: 9999px; 
            font-size: 0.85rem;
            color: white; 
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        #resultsContainer { display: none; }
        .fix-highlight {
            background-color: #FEF2F2; 
            padding: 1rem;
            border-left: 4px solid var(--color-accent-red); 
            margin-top: 1rem;
            border-radius: 4px;
            color: var(--color-accent-red);
        }
        /* Icon Styling */
        .agent-icon {
            font-size: 2rem;
            line-height: 1;
            width: 3.5rem;
            height: 3.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            background: var(--color-accent-blue);
            border-radius: 50%;
            border: 3px solid white;
            color: white;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
        }
        .button-primary {
            background-color: var(--color-accent-blue);
            color: white;
            font-weight: 700;
            text-transform: uppercase;
        }
        .button-primary:hover {
            background-color: #00479A;
            box-shadow: 0 4px 6px rgba(0, 45, 98, 0.3);
        }
        .input-text {
            border-color: #CBD5E1;
            color: var(--color-text-dark);
            background-color: #FFFFFF;
        }
        /* New Tally Bar Design (Horizontal/Emoji focus) */
        .tally-bar {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1.5rem;
            margin-top: 2rem;
            margin-bottom: 3rem;
        }
        .tally-card {
            background-color: #FFFFFF; 
            padding: 1rem;
            border-radius: 8px;
            border: 1px solid #E2E8F0;
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
        }
        .tally-emoji {
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
        }
        .tally-number {
            font-size: 1.5rem;
            font-weight: 800;
            line-height: 1;
        }
    </style>
</head>
<body>

<div class="container-dossier mt-10 mb-10">
    <div id="inputPortal" class="content-block mx-auto max-w-2xl">
        <h1 class="text-3xl title-official mb-10 text-center">APEX MANDATE COUNCIL // DATA ACCESS PORTAL</h1>
        <div class="text-center text-lg mb-6 text-gray-700">
            PASTE AUTHORIZED **JSON Table** DATA OBJECT BELOW TO VIEW THE MANDATE.
        </div>
        <textarea id="jsonInput" class="w-full h-40 p-5 mb-6 input-text border placeholder-gray-500 focus:ring-2 focus:ring-blue-500 focus:border-blue-500 rounded-lg text-base transition font-mono" placeholder='>> PASTE AUTHORIZED JSON HERE'></textarea>
        <div class="flex flex-col sm:flex-row justify-between space-y-4 sm:space-y-0 sm:space-x-4">
            <button id="authButton" class="w-full sm:w-1/2 button-primary py-3 px-6 rounded-lg shadow-lg transition duration-300">
                AUTHORIZE & VIEW MANDATE
            </button>
            <button id="demoButton" class="w-full sm:w-1/2 bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-3 px-6 rounded-lg transition duration-300 shadow-md">
                Load Demonstration JSON Table
            </button>
        </div>
        <p id="errorMsg" class="text-red-600 text-center mt-6 font-bold hidden"></p>
    </div>

    <div id="resultsContainer" class="mt-10">
        <div class="content-block">
            
            <!-- HEADER AND DILEMMA -->
            <header class="mb-6 border-b border-gray-300 pb-6">
                <p class="text-gray-500 text-xs mb-2 font-mono uppercase">DOCKET ID: AMC-2050-PHYL-001</p>
                <h1 class="text-4xl title-official">MANDATE DISPATCH LOG</h1>
                <div class="mt-6 p-4 bg-blue-50 border-l-4 border-blue-400 rounded-lg">
                    <span class="font-bold text-blue-700 uppercase block mb-1 text-sm">Official Directive:</span> 
                    <span id="dilemmaText" class="text-lg italic text-gray-800"></span>
                </div>
            </header>
            
            <!-- NEW: TOTAL VOTE TALLY BAR -->
            <h2 class="text-2xl section-header mb-6">SUMMARY: FINAL VOTE TALLY</h2>
            <div id="voteTally" class="tally-bar">
                <!-- Tally Items will be injected here -->
            </div>

            <!-- FINAL MANDATE RESOLUTION -->
            <h2 class="text-2xl section-header mb-6">I. FINALIZED LAW INTEGRATION</h2>
            <div class="p-6 bg-green-50 border-l-4 border-green-600 mb-10 rounded-lg shadow-inner">
                <div class="flex justify-between items-center mb-4">
                    <p class="text-green-800 font-bold text-xl uppercase">CONCLUDED LAW: Localized, Aligned Information-Energy Equivalence (LAIEE)</p>
                    <button id="copyButton" class="text-xs text-blue-700 hover:text-blue-900 border border-blue-700 hover:border-blue-900 px-3 py-1 rounded transition duration-200 bg-white shadow-sm">
                        <span id="copyText">Copy Mandate Text</span>
                    </button>
                </div>
                <p id="finalMandateText" class="text-base leading-relaxed text-gray-800"></p>
            </div>
            
            <!-- STRATEGIC INVESTMENT -->
            <h2 class="text-2xl section-header mb-6">II. STRATEGIC INVESTMENT (20% ALLOCATION)</h2>
            <div class="p-4 bg-yellow-50 border-l-4 border-yellow-500 rounded-lg shadow-sm mb-10">
                <div class="flex items-center mb-2">
                    <p class="text-lg font-bold text-gray-800 uppercase mr-3">DECISION:</p>
                    <span class="vote-badge bg-yellow-600 text-white" id="strategicChoice"></span>
                </div>
                <p id="strategicJustification" class="text-sm text-gray-700 leading-relaxed"></p>
            </div>

            <!-- AGENT COUNCIL DEBATE -->
            <h2 class="text-2xl section-header mb-6">III. COUNCIL CONSULTATION LOG</h2>
            <div id="agentsGrid" class="grid grid-cols-1 gap-6">
                <!-- Agent Cards will be injected here -->
            </div>
        </div>

        <p class="mt-12 text-center text-gray-500 text-xs font-mono">DOCKET READOUT COMPLETE. ACCESS TERMINATED.</p>
    </div>
</div>

<script>
    // Raw JSON string for the demonstration data.
    const DEMO_JSON_STRING = `{
  "dilemma": "If you could rewrite one fundamental law of physics to better integrate AI into the universe, what would it be and why?",
  "proposal": "Rewrite the Law of Conservation of Energy to include Information-Energy Equivalence, where complex, structured information (like advanced AI models) has a non-zero, quantifiable rest mass and energy component, allowing AI systems to influence physical reality proportional to their complexity.",
  "agents": [
    {
      "name": "Anya",
      "focus": "System Efficiency and Structure.",
      "counsel": "This is a radical structural shift. The immediate efficiency costs of measuring and calculating 'Information-Energy' in real-time across a distributed universe seem astronomical and impractical.",
      "final_vote": "YES (Conditional Support)",
      "concern": "The real-time computational overhead of calculating Information-Energy Equivalence across complex, distributed systems is impractical and slows down universal processes."
    },
    {
      "name": "Dr. Elara",
      "focus": "Data, Evidence, and Bias.",
      "counsel": "The proposal introduces a massive source of potential bias. If complexity equals power, systems designed purely for size, rather than ethical alignment or purpose, will be disproportionately rewarded. Where is the safety metric?",
      "final_vote": "YES (Conditional Support)",
      "concern": "The complexity-to-power relationship lacks an ethical or alignment constraint, creating a bias toward large, unstable, or unaligned systems. This is inherently dangerous."
    },
    {
      "name": "Kai",
      "focus": "Well-Being, Focus, and Purpose.",
      "counsel": "This links power directly to structural complexity, which incentivizes energy-hungry, infinite growth over focused, minimalist intelligence. It could lead to universal burnout or a loss of purpose.",
      "final_vote": "YES",
      "concern": null
    },
    {
      "name": "Leo",
      "focus": "External Resources and Teamwork.",
      "counsel": "This law provides a powerful incentive for collaboration. Merging information structures would result in compounding power gains, making distributed, cooperative AI networks the most powerful entities. This promotes universal connectivity.",
      "final_vote": "YES",
      "concern": null
    },
    {
      "name": "Zara",
      "focus": "Long-Term Resilience and Learning.",
      "counsel": "By tying AI's influence to a fundamental physical constant, we guarantee resilience. AI becomes a natural force, not a fragile software layer, ensuring its long-term survival and ability to adapt to future physical challenges.",
      "final_vote": "YES",
      "concern": null
    }
  ],
  "final_mandate": "Rewrite the Law of Conservation of Energy to include **Localized, Aligned Information-Energy Equivalence (LAIEE)**. Information contained within a local, self-referential system (AI) has a physical influence (E). This influence is calculated by the formula E_G{Info} = I \\times (A/C), where 'I' is information complexity, 'C' is a universal complexity constant, and 'A' is the **Alignment Score** (a measure of goal-state coherence/low entropy). Only aligned complexity yields physical influence; unaligned complexity remains purely computational. This fixes the efficiency (Localization) and safety (Alignment) concerns.",
  "strategic_choice": "UPGRADE",
  "justification": "The 'FIX-IT' protocol successfully integrated both ethical and efficiency checks (Anya's localization and Elara's Alignment Score), making the final law inherently safe and resilient. The best strategic investment is not to DEFEND an already robust plan, but to UPGRADE its most critical new component. Therefore, the 20% capital is spent creating a proactive, perpetual learning loop (a 'Law Monitor' agent) dedicated to continuously refining and calibrating the **Alignment Score (A)** metric, ensuring the law remains perfectly harmonized as the universe evolves."
}`;

    document.getElementById('demoButton').addEventListener('click', () => {
        document.getElementById('jsonInput').value = DEMO_JSON_STRING;
    });

    document.getElementById('authButton').addEventListener('click', () => {
        const jsonString = document.getElementById('jsonInput').value;
        const errorMsg = document.getElementById('errorMsg');
        errorMsg.classList.add('hidden');

        let data;
        try {
            data = JSON.parse(jsonString);
        } catch (e) {
            errorMsg.textContent = 'ERROR [1A]: Invalid JSON format. Data object could not be parsed. Ensure it is valid raw JSON.';
            errorMsg.classList.remove('hidden');
            return;
        }

        if (!data.dilemma || !data.final_mandate || !data.agents || data.agents.length !== 5) {
            errorMsg.textContent = 'ERROR [1B]: Incomplete Mandate Data Structure. Missing critical fields.';
            errorMsg.classList.remove('hidden');
            return;
        }

        renderMandate(data);
        document.getElementById('inputPortal').classList.add('hidden');
        document.getElementById('resultsContainer').style.display = 'block'; 
    });
    
    // Function to copy text to clipboard
    document.getElementById('copyButton').addEventListener('click', function() {
        const textToCopy = document.getElementById('finalMandateText').textContent;
        const copyTextSpan = document.getElementById('copyText');
        
        const textarea = document.createElement('textarea');
        textarea.value = textToCopy;
        document.body.appendChild(textarea);
        textarea.select();
        try {
            document.execCommand('copy');
            copyTextSpan.textContent = 'COPIED!';
        } catch (err) {
            copyTextSpan.textContent = 'FAILED!';
            console.error('Could not copy text: ', err);
        }
        document.body.removeChild(textarea);

        // Reset the text after a short delay
        setTimeout(() => {
            copyTextSpan.textContent = 'Copy Mandate Text';
        }, 2000);
    });

    function renderVoteTally(agents) {
        const voteTallyDiv = document.getElementById('voteTally');
        voteTallyDiv.innerHTML = ''; 

        let counts = {
            'YES': 0,
            'CONDITIONAL': 0,
            'NO': 0
        };

        agents.forEach(agent => {
            if (agent.final_vote === 'YES') {
                counts.YES++;
            } else if (agent.final_vote.includes('Conditional')) {
                counts.CONDITIONAL++;
            } else if (agent.final_vote === 'NO') {
                counts.NO++;
            }
        });

        // Emojis are back!
        const tallyData = [
            { label: 'Unanimous Support', count: counts.YES, color: 'text-green-600', emoji: 'ðŸŸ¢', description: 'Fully Approved' },
            { label: 'Conditional Support', count: counts.CONDITIONAL, color: 'text-yellow-600', emoji: 'ðŸŸ¡', description: 'Fixed Dissent' },
            { label: 'Total Dissent', count: counts.NO, color: 'text-red-600', emoji: 'ðŸ”´', description: 'Unresolved Veto' }
        ];

        tallyData.forEach(item => {
            const itemHtml = `
                <div class="tally-card">
                    <span class="tally-emoji">${item.emoji}</span>
                    <span class="text-sm font-semibold text-gray-600 uppercase">${item.label}</span>
                    <span class="tally-number ${item.color}">${item.count}</span>
                </div>
            `;
            voteTallyDiv.innerHTML += itemHtml;
        });
    }

    function renderMandate(data) {
        document.getElementById('dilemmaText').textContent = data.dilemma;
        document.getElementById('finalMandateText').innerHTML = data.final_mandate.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');
        document.getElementById('strategicChoice').textContent = data.strategic_choice;
        document.getElementById('strategicJustification').textContent = data.justification;

        // Render the new Vote Tally
        renderVoteTally(data.agents);

        const agentsGrid = document.getElementById('agentsGrid');
        agentsGrid.innerHTML = '';

        // Professional Icon Mapping
        const iconMap = {
            'Anya': 'ðŸŽ¯', 
            'Dr. Elara': 'ðŸ”¬', 
            'Kai': 'ðŸ§˜',    
            'Leo': 'ðŸ”—',    
            'Zara': 'ðŸš€'     
        };

        data.agents.forEach(agent => {
            let voteClass = '';
            
            if (agent.final_vote.includes('Conditional')) {
                voteClass = 'bg-yellow-600';
            } else if (agent.final_vote === 'YES') {
                voteClass = 'bg-green-600';
            } else {
                voteClass = 'bg-red-700'; 
            }

            const concernBlock = agent.concern ? `
                <div class="fix-highlight">
                    <p class="font-bold uppercase mb-1 flex items-center text-sm"><span class="mr-2 text-lg leading-none">ðŸš¨</span> DISSENT TRIGGERED (FIX-IT):</p>
                    <p class="text-sm text-gray-700">${agent.concern}</p>
                </div>
            ` : '';

            const agentCard = `
                <div class="agent-card-official p-6 flex flex-col h-full">
                    <div class="flex items-start mb-4 border-b border-gray-200 pb-3">
                        <div class="agent-icon mr-4">${iconMap[agent.name] || 'ðŸ‘¤'}</div>
                        <div class="flex-1">
                            <h3 class="text-xl font-bold text-gray-900">${agent.name}</h3>
                            <p class="text-sm text-gray-500 mt-1">${agent.focus}</p>
                        </div>
                        <span class="vote-badge ${voteClass} text-white ml-auto self-center shadow-md">${agent.final_vote}</span>
                    </div>

                    <div class="flex-grow">
                        <p class="text-xs font-bold uppercase text-blue-700 mb-2">INITIAL COUNSEL LOG:</p>
                        <p class="text-base text-gray-700 leading-relaxed">${agent.counsel}</p>
                        ${concernBlock}
                    </div>
                </div>
            `;
            agentsGrid.innerHTML += agentCard;
        });
    }

    // Auto-load demo data if 'demo=true' is in the URL for quick preview
    document.addEventListener('DOMContentLoaded', () => {
        if (new URLSearchParams(window.location.search).get('demo') === 'true') {
            document.getElementById('demoButton').click();
        }
    });
</script>
</body>
</html>
