<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>U.S. Policy Artifact Portal - A-AWRA</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Load Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        /* OFFICIAL POLICY BRIEF AESTHETIC */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300..900&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: white; /* Pure White Background */
            color: #111827; /* Near Black/Very Dark Gray text for contrast */
        }
        .authority-header {
            background-color: #ffffff;
            border-bottom: 2px solid #e5e5e5; /* Thin light separator */
        }
        .section-bg {
            background-color: #ffffff; /* All content on white background */
        }
        .primary-accent {
            color: #1f2937; /* Deep Charcoal for main headings */
        }
        .secondary-accent {
            color: #6b7280; /* Muted Gray for labels and metadata */
        }
        .data-panel-border {
            border: 1px solid #d1d5db; /* Very light gray border for separation */
        }
        .pill {
            padding: 2px 8px;
            border-radius: 2px; /* Sharper corners */
            font-weight: 700;
            font-size: 0.65rem; /* Smaller, more precise text */
            text-transform: uppercase;
        }
        .yes-pill {
            background-color: #f0fdf4; /* Very Light Mint */
            color: #10b981; /* Emerald Green */
            border: 1px solid #d1fae5;
        }
        .no-pill {
            background-color: #fff1f2; /* Very Light Pink */
            color: #f87171; /* Red */
            border: 1px solid #fee2e2;
        }
        .input-box {
            min-height: 300px;
            resize: vertical;
            font-family: monospace;
            font-size: 0.9rem;
            line-height: 1.5;
        }
        .document-separator {
            width: 100%;
            height: 1px;
            background-color: #e5e7eb;
        }

        /* NEW PROGRESS BAR & INTERACTIVITY STYLES */
        .bar-yes-unconditional {
            background-color: #1e40af; /* Deep Navy Blue (Primary Authority) */
            color: white;
            font-weight: 700;
        }
        .bar-yes-conditional {
            background-color: #3b82f6; /* Medium Blue (Qualified Support) */
            color: white;
            font-weight: 700;
        }
        .bar-no-dissent {
            background-color: #dc2626; /* Deep Red (Dissent/Major Concern) */
            color: white;
            font-weight: 700;
        }
        .legend-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }
        
        .agent-card-base {
            transition: all 0.3s ease-in-out;
            cursor: default;
        }
        .highlight-card {
            border: 3px solid #f97316; /* Professional Orange/Amber highlight */
            box-shadow: 0 0 10px rgba(249, 115, 22, 0.4);
            background-color: #fff7ed; /* Very light subtle background for highlight */
        }
        .dim-card {
            opacity: 0.35;
            filter: grayscale(50%);
        }

        /* Improved Header for Dilemma/Proposal */
        .section-header-bar {
            background-color: #f9fafb; /* Light Grayish background for bars */
            border-bottom: 1px solid #e5e7eb;
            padding-bottom: 0.5rem;
            margin-bottom: 1rem;
        }
    </style>
</head>
<body class="min-h-screen antialiased">

    <!-- Header Section (Authority Bar - Reduced visual noise) -->
    <header class="authority-header sticky top-0 z-10">
        <div class="max-w-7xl mx-auto px-6 lg:px-8 py-5 flex justify-between items-center">
            <div class="flex items-center space-x-3">
                <i data-lucide="shield-check" class="w-7 h-7 text-red-600"></i>
                <h1 class="text-xl font-bold tracking-wider primary-accent uppercase">
                    POLICY ANALYSIS & RESOLUTION CENTER <span class="secondary-accent text-sm">| PARC</span>
                </h1>
            </div>
            <button id="load-toggle-button" onclick="toggleArtifactView(true)" class="text-sm text-gray-500 hover:text-gray-700 transition hidden">
                <i data-lucide="upload" class="w-4 h-4 inline-block mr-1"></i>
                LOAD NEW ARTIFACT
            </button>
        </div>
    </header>

    <!-- Main Content Area -->
    <main class="max-w-7xl mx-auto px-6 lg:px-8 py-16">

        <!-- JSON Input Area -->
        <section id="input-area" class="section-bg p-10 data-panel-border rounded-lg">
            <h2 class="text-3xl font-extrabold primary-accent mb-4 uppercase">
                DATA INJECTION PROTOCOL
            </h2>
            <p class="text-gray-600 mb-6 border-b pb-4">
                Input the standardized Policy Artifact JSON into the field below. Validation is required prior to rendering the official brief format.
            </p>
            <textarea id="json-input" class="input-box w-full p-4 bg-gray-50 border border-gray-300 rounded-md text-gray-800 placeholder-gray-400 focus:ring-gray-400 focus:border-gray-400 transition duration-200" placeholder='{"dilemma": "...", "proposal": "...", "agents": [...], "final_mandate": "..."}'></textarea>
            
            <div class="mt-4 flex flex-col sm:flex-row space-y-3 sm:space-y-0 sm:space-x-4">
                <button onclick="loadArtifact()" class="w-full sm:w-auto bg-gray-800 hover:bg-gray-700 text-white font-bold py-3 px-6 rounded-md transition duration-200 shadow-md">
                    <i data-lucide="code" class="w-5 h-5 inline-block mr-2"></i>
                    AUTHENTICATE & RENDER
                </button>
                <button onclick="clearInput()" class="w-full sm:w-auto bg-gray-200 hover:bg-gray-300 text-gray-700 font-medium py-3 px-6 rounded-md transition duration-200 shadow-sm">
                    CLEAR INPUT
                </button>
            </div>
            <div id="error-message" class="text-red-600 mt-4 hidden"></div>
        </section>

        <!-- Artifact Display Area (Initially Hidden) -->
        <section id="artifact-display" class="hidden">
            
            <!-- Metadata Block -->
            <div class="mb-12 border-b-2 border-gray-400 pb-4">
                <p class="text-sm font-medium secondary-accent mb-2">POLICY ARTIFACT ID:</p>
                <p id="artifact-id" class="text-xl font-mono primary-accent inline-block mr-8">2025-Q4/AIPR-21B</p>
                <p class="text-sm font-medium secondary-accent inline-block mr-2">CLASSIFICATION:</p>
                <span class="text-green-600 text-lg font-bold">AUTHORIZED DRAFT</span>
            </div>
            
            <!-- Document Title -->
            <h2 id="artifact-title" class="text-5xl font-black primary-accent mb-12 tracking-tighter leading-tight">
                [TITLE PLACEHOLDER]
            </h2>


            <!-- DILEMMA & PROPOSAL (Section 1) -->
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-10 mb-12">
                
                <!-- Dilemma Panel -->
                <div class="lg:col-span-1 border-r border-gray-200 pr-8">
                    <div class="flex items-center mb-4 section-header-bar text-red-600">
                        <i data-lucide="alert-triangle" class="w-5 h-5 mr-2"></i>
                        <h3 class="text-sm font-bold uppercase tracking-widest text-red-600">MISSION DILEMMA</h3>
                    </div>
                    <p id="dilemma-content" class="text-gray-700 leading-relaxed"></p>
                </div>

                <!-- Proposal Panel -->
                <div class="lg:col-span-2">
                    <div class="flex items-center mb-4 section-header-bar text-blue-600">
                        <i data-lucide="lightbulb" class="w-5 h-5 mr-2"></i>
                        <h3 class="text-sm font-bold uppercase tracking-widest text-blue-600">INITIAL PROPOSAL</h3>
                    </div>
                    <p id="proposal-content" class="text-gray-700 leading-relaxed"></p>
                </div>
            </div>
            
            <div class="document-separator my-10"></div>


            <!-- CONSENSUS OVERVIEW (Section 2 - Updated with Progress Bar) -->
            <div class="mb-12">
                <h3 class="text-xl font-extrabold primary-accent mb-6 flex items-center border-b pb-2">
                    <i data-lucide="workflow" class="w-5 h-5 mr-3 secondary-accent"></i>
                    COUNCIL CONSENSUS OVERVIEW
                </h3>

                <!-- Progress Bar Container -->
                <div id="progress-bar-container" class="w-full h-8 bg-gray-200 rounded-md overflow-hidden mb-6 flex data-panel-border">
                    <!-- Segments will be injected here by JS -->
                </div>

                <!-- Legend and Counts -->
                <div id="vote-legend" class="grid grid-cols-3 gap-6 text-sm mb-8">
                    <!-- Legend Items will be injected here by JS -->
                </div>

                <!-- Strategic Choice and Justification -->
                <div class="document-separator my-6"></div>
                <div class="grid grid-cols-1 lg:grid-cols-4 gap-6 items-start">
                    <div class="lg:col-span-1 border-r border-gray-200 pr-6">
                        <p class="text-xs font-medium secondary-accent mb-1 uppercase">STRATEGIC CHOICE</p>
                        <p id="strategic-choice" class="text-4xl font-black text-red-600 tracking-tighter leading-none"></p>
                    </div>
                    <div class="lg:col-span-3">
                        <p class="text-xs font-medium secondary-accent mb-1 uppercase">COUNCIL JUSTIFICATION / RATIONALE</p>
                        <p id="justification-content" class="text-gray-700 italic leading-normal"></p>
                    </div>
                </div>
            </div>

            <!-- AGENTS / COUNCIL DELIBERATION (Section 3) -->
            <div class="mb-12">
                <h3 class="text-xl font-extrabold primary-accent mb-6 border-b pb-2">DELIBERATION AGENT REPORTS</h3>
                <div id="agents-container" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
                    <!-- Agent Cards will be injected here by JS -->
                </div>
            </div>
            
            <div class="document-separator my-10"></div>

            <!-- FINAL MANDATE (Section 4) -->
            <div class="p-8 border-2 border-gray-300 rounded-lg bg-gray-50">
                <h3 class="text-2xl font-black primary-accent mb-6 flex items-center uppercase">
                    <i data-lucide="gavel" class="w-6 h-6 mr-3 text-green-600"></i>
                    FINAL MANDATE: THE RESOLUTION
                </h3>

                <!-- Mandate Details -->
                <div class="p-4 bg-white rounded-md border border-gray-200">
                    <p id="mandate-content" class="text-gray-800 leading-loose font-medium"></p>
                </div>
            </div>

        </section>

        <!-- Footer -->
        <footer class="mt-20 pt-8 border-t border-gray-200 text-center text-gray-500 text-xs">
            <p>U.S. Policy Analysis & Resolution Center | Document Revision 1.4 | ACCESS LEVEL 3 REQUIRED</p>
        </footer>

    </main>

    <script>
        const defaultArtifactId = 'A-AWRA';
        const defaultTitle = 'AI Acceleration & Workforce Resilience Act';
        let currentFilter = null; // Stores the currently active filter type ('unconditional', 'conditional', 'dissent')

        /**
         * Safely parses JSON and handles errors.
         * @returns {Object|null} The parsed JSON object or null on error.
         */
        function parseJsonInput() {
            const inputElement = document.getElementById('json-input');
            const errorElement = document.getElementById('error-message');
            errorElement.classList.add('hidden');
            
            try {
                const data = JSON.parse(inputElement.value.trim());
                if (!data || !data.dilemma || !data.proposal || !data.agents || !data.final_mandate) {
                    throw new Error("JSON is missing required fields (dilemma, proposal, agents, final_mandate).");
                }
                return data;
            } catch (e) {
                errorElement.textContent = `JSON Error: ${e.message}`;
                errorElement.classList.remove('hidden');
                return null;
            }
        }

        /**
         * Filters and highlights agent cards based on the selected vote type.
         * @param {string} voteType - The vote category to highlight ('unconditional', 'conditional', 'dissent').
         */
        function filterAgents(voteType) {
            const agentCards = document.querySelectorAll('.agent-card-base');
            const legendItems = document.querySelectorAll('.legend-item');
            
            // 1. Determine if the filter needs to be applied or reset
            if (currentFilter === voteType) {
                // Reset filter
                currentFilter = null;
                voteType = null;
            } else {
                currentFilter = voteType;
            }

            // 2. Apply/Reset highlighting on cards
            agentCards.forEach(card => {
                card.classList.remove('highlight-card', 'dim-card');
                if (voteType && card.dataset.voteType !== voteType) {
                    card.classList.add('dim-card');
                } else if (voteType && card.dataset.voteType === voteType) {
                    card.classList.add('highlight-card');
                }
            });

            // 3. Update legend button state (optional: visually indicate the active filter)
            legendItems.forEach(item => {
                item.classList.remove('bg-gray-200'); // Simple visual change for active button
                if (item.dataset.voteType === currentFilter) {
                    item.classList.add('bg-gray-200');
                }
            });
        }


        /**
         * Renders the artifact data into the HTML structure.
         * @param {Object} data The parsed JSON object.
         */
        function renderArtifact(data) {
            // Reset filter state before rendering new data
            currentFilter = null;
            
            // 1. Set Title and Metadata
            document.getElementById('artifact-title').textContent = data.title || defaultTitle;
            document.getElementById('artifact-id').textContent = data.artifactId || '2025-Q4/AIPR-21B';

            // 2. Dilemma & Proposal
            document.getElementById('dilemma-content').textContent = data.dilemma;
            document.getElementById('proposal-content').textContent = data.proposal;
            
            // 3. Consensus Overview - New Logic
            const totalAgents = data.agents.length;
            let unconditionalYes = 0;
            let conditionalYes = 0;
            let noVotes = 0;

            data.agents.forEach(agent => {
                if (agent.final_vote === 'YES') {
                    unconditionalYes++;
                } else if (agent.final_vote && agent.final_vote.startsWith('YES (Conditional')) {
                    conditionalYes++;
                } else {
                    noVotes++;
                }
            });

            const percentUnconditional = (unconditionalYes / totalAgents) * 100;
            const percentConditional = (conditionalYes / totalAgents) * 100;
            const percentNo = (noVotes / totalAgents) * 100;

            const progressBarContainer = document.getElementById('progress-bar-container');
            progressBarContainer.innerHTML = ''; // Clear existing bar

            const segmentsData = [
                { percent: percentUnconditional, count: unconditionalYes, label: 'Full Consensus', colorClass: 'bar-yes-unconditional', voteType: 'unconditional' },
                { percent: percentConditional, count: conditionalYes, label: 'Qualified Consensus', colorClass: 'bar-yes-conditional', voteType: 'conditional' },
                { percent: percentNo, count: noVotes, label: 'Dissent/No Vote', colorClass: 'bar-no-dissent', voteType: 'dissent' }
            ].filter(s => s.percent > 0); // Only show segments with votes

            segmentsData.forEach(segment => {
                const segmentElement = document.createElement('div');
                segmentElement.className = `${segment.colorClass} h-full text-center text-xs flex items-center justify-center whitespace-nowrap px-1 interactive-click`;
                segmentElement.style.width = `${segment.percent}%`;
                segmentElement.dataset.voteType = segment.voteType;
                segmentElement.onclick = () => filterAgents(segment.voteType);
                
                if (segment.percent >= 10) { // Only display text if segment is wide enough
                    segmentElement.textContent = `${segment.count} (${Math.round(segment.percent)}%)`;
                } else if (segment.percent > 0) {
                     segmentElement.title = `${segment.label}: ${segment.count} (${Math.round(segment.percent)}%)`;
                }
                progressBarContainer.appendChild(segmentElement);
            });

            // Legend
            const legendContainer = document.getElementById('vote-legend');
            legendContainer.innerHTML = segmentsData.map(segment => {
                let hexColor;
                if (segment.voteType === 'unconditional') hexColor = '#1e40af';
                else if (segment.voteType === 'conditional') hexColor = '#3b82f6';
                else hexColor = '#dc2626';

                return `
                    <div class="flex items-center text-gray-700 interactive-click legend-item p-1 rounded-sm cursor-pointer hover:bg-gray-100" data-vote-type="${segment.voteType}" onclick="filterAgents('${segment.voteType}')">
                        <div class="legend-dot" style="background-color: ${hexColor};"></div>
                        <span class="font-medium">${segment.label}:</span>
                        <span class="font-bold ml-1">${segment.count} / ${totalAgents}</span>
                    </div>
                `;
            }).join('');

            document.getElementById('strategic-choice').textContent = data.strategic_choice;
            document.getElementById('justification-content').textContent = data.justification;

            // 4. Final Mandate
            document.getElementById('mandate-content').textContent = data.final_mandate;

            // 5. Agents Deliberation
            const agentsContainer = document.getElementById('agents-container');
            agentsContainer.innerHTML = ''; // Clear previous content

            data.agents.forEach((agent, index) => {
                const isConcernResolved = !agent.concern;
                const concernColor = isConcernResolved ? 'text-green-600' : 'text-red-600';
                const concernIcon = isConcernResolved ? 'check-circle' : 'minus-circle';
                const concernText = isConcernResolved ? "None. Fully integrated into Final Mandate." : agent.concern;
                const voteType = agent.final_vote === 'YES' ? 'unconditional' : (agent.final_vote && agent.final_vote.startsWith('YES (Conditional') ? 'conditional' : 'dissent');
                const voteClass = voteType !== 'dissent' ? 'yes-pill' : 'no-pill';
                const voteText = agent.final_vote || 'NO VOTE';

                const agentHTML = `
                    <div class="p-5 data-panel-border rounded-lg bg-gray-50 agent-card-base" data-vote-type="${voteType}">
                        <div class="flex items-center justify-between mb-3 border-b pb-2">
                            <span class="text-lg font-bold text-gray-900">${agent.name}</span>
                            <span class="pill ${voteClass}">${voteText}</span>
                        </div>
                        <p class="text-xs text-gray-500 mb-3 uppercase font-medium">DOMAIN: ${agent.focus}</p>
                        
                        <div class="p-3 bg-white rounded-md border border-gray-200 mb-3">
                            <p class="text-xs font-bold ${concernColor} mb-1 flex items-center">
                                <i data-lucide="${concernIcon}" class="w-3 h-3 mr-1"></i>
                                PRIMARY CONCERN
                            </p>
                            <p class="text-sm text-gray-700 leading-tight">${concernText}</p>
                        </div>
                        <p class="text-sm text-gray-600 font-normal mt-4">COUNSEL: ${agent.counsel}</p>
                    </div>
                `;
                agentsContainer.insertAdjacentHTML('beforeend', agentHTML);
            });
            
            // Re-initialize lucide icons for the newly injected HTML
            lucide.createIcons(); 
        }

        /**
         * Controls visibility of the input and display areas.
         * @param {boolean} showInput Whether to show the input area (true) or the display area (false).
         */
        function toggleArtifactView(showInput) {
            const inputArea = document.getElementById('input-area');
            const displayArea = document.getElementById('artifact-display');
            const toggleButton = document.getElementById('load-toggle-button');

            if (showInput) {
                inputArea.classList.remove('hidden');
                displayArea.classList.add('hidden');
                toggleButton.classList.add('hidden');
            } else {
                inputArea.classList.add('hidden');
                displayArea.classList.remove('hidden');
                toggleButton.classList.remove('hidden');
            }
        }

        /**
         * Main function to load and display the artifact.
         */
        function loadArtifact() {
            const data = parseJsonInput();
            if (data) {
                renderArtifact(data);
                toggleArtifactView(false); // Show the results
            }
        }

        /**
         * Clears the JSON input field.
         */
        function clearInput() {
            document.getElementById('json-input').value = '';
            document.getElementById('error-message').classList.add('hidden');
        }

        // Initialize icons on first load
        lucide.createIcons(); 
        
        // Populate the input area with the previous JSON for easy testing
        window.onload = function() {
            document.getElementById('json-input').value = JSON.stringify({ "dilemma": "In what ways can AI boost U.S. productivity and GDP growth, and what investments in education and retraining are needed to prepare the workforce?", "proposal": "The U.S. should launch a 'National AI Productivity Initiative' by dedicating a 20% tax credit for three years on all corporate AI capital investments (hardware, software, data) to drive rapid adoption, paired with a mandatory, publicly-funded 'AI Skills Passport' system that subsidizes 100% of training costs for mid-career workers in high-exposure occupations.", "agents": [ { "name": "Nova", "focus": "Making things run smoothly and efficiently.", "counsel": "The combined investment approach is smart. The tax credit will massively accelerate AI deployment, which is the engine for productivity gains. However, a major administrative bottleneck will be the 'AI Skills Passport.' To make this efficient, the Passport must leverage AI itself for hyper-personalized learning pathways, matching local job demand with worker skill gaps automatically, otherwise it becomes a bureaucratic mess.", "final_vote": "YES (Conditional Support)", "concern": "The 'AI Skills Passport' risks major administrative bloat and inefficiency if it doesn't use AI to streamline personalized learning and instantly match skills to local employer demand." }, { "name": "Orion", "focus": "Checking facts and keeping things logical.", "counsel": "Facts show AI is already driving economic growth through capital investmentâ€”investment growth from tech categories recently outpaced consumer spending. The tax credit is a clear accelerant. But without specific accountability, companies might use the tax credit simply to automate and cut labor without truly improving total factor productivity. The credit should require a documented commitment to augmentation (AI helping people) over pure automation (AI replacing people) to get the full benefit.", "final_vote": "YES (Conditional Support)", "concern": "The 20% tax credit could be misused to fund pure job-eliminating automation without genuine productivity gains, leading to social instability. It needs an accountability clause." }, { "name": "Selene", "focus": "Keeping things fair, ethical, and sustainable.", "counsel": "While AI boosts productivity, data shows the economic benefits are currently concentrating among higher earners and in a few high-tech states, creating a 'K-shaped' recovery. The Skills Passport is crucial for fairness, but we must actively direct retraining toward 'low AI-exposed' or highly complementary jobs, as workers in high-exposure jobs, even after retraining, often see lower earnings. We need to be proactive about equity.", "final_vote": "YES (Conditional Support)", "concern": "Retraining alone is not enough; it must be strategically guided. Programs need to focus on foundational, social, and critical thinking skills, and direct workers toward new, AI-complementary occupations, not just attempt to save highly automatable ones." }, { "name": "Vortex", "focus": "Bringing resources and people together.", "counsel": "This is a prime public-private partnership opportunity. We should formalize the collaboration with major tech companies (like Google, IBM, Microsoft, etc.) that are already investing hundreds of millions in AI training and curriculum. Instead of building everything from scratch, the 'Passport' should simply standardize and accredit existing, high-quality industry certifications and training platforms.", "final_vote": "YES", "concern": null }, { "name": "Echo", "focus": "Growing and planning ahead.", "counsel": "For long-term growth, the biggest return isn't just in retraining today's workers, but in preparing the next generation. We must invest heavily in K-12 AI literacy and computational thinking curricula. This creates a lasting foundation and a pipeline of talent that will ensure continuous innovation and adaptability beyond the initial three-year corporate tax break.", "final_vote": "YES", "concern": null } ], "final_mandate": "Let's launch the 'AI Acceleration and Workforce Resilience Act' (A-AWRA). It includes a 20% tax credit for corporate AI capital investment, but to address Orion's point, the full credit is conditional on a certified 'AI Augmentation Plan' detailing how the investment maintains or reskills at least 80% of affected labor. To fix Nova's and Selene's concerns, the publicly-funded 'AI Skills Passport' will be an AI-driven platform that standardizes industry-recognized certifications (Vortex's idea) and prioritizes training for foundational, human-centric skills (like critical thinking and communication), actively steering workers toward high-growth, AI-complementary roles, not just highly automatable ones. Furthermore, a permanent, modest fund will be established for K-12 AI Literacy Curriculum development (Echo's priority).", "strategic_choice": "UPGRADE", "justification": "The Council unanimously agrees that a passive approach (DEFEND) would risk exacerbating economic inequality by concentrating AI's benefits in a few sectors and demographics. Therefore, we choose to UPGRADE the system. Our final, integrated mandate is a robust, dual-focused strategy that not only uses the 20% investment to accelerate corporate AI adoption (the engine of productivity) but also mandates equitable and smart workforce preparation by linking corporate incentives to labor-protective plans and steering public retraining toward future-proof, human-centric skills, directly addressing core concerns of efficiency, accountability, and fairness." });
            loadArtifact(); // Load the default data on page load
        }
    </script>
</body>
</html>
