<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Health Diary</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&family=Playfair+Display:wght@700&display=swap" rel="stylesheet">
    <style>
        html { scroll-behavior: smooth; }
        body {
            font-family: 'Inter', sans-serif;
            background-color: #FEFBFD; /* Fallback background */
            overflow-x: hidden;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
        .animated-background {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -2;
            background: linear-gradient(180deg, #FFF5F9 0%, #FEFBFD 100%);
            background-size: 200% 200%; animation: gradient-animation 15s ease infinite;
        }
        @keyframes gradient-animation { 0% { background-position: 50% 0%; } 50% { background-position: 50% 100%; } 100% { background-position: 50% 0%; } }
        #flower-container { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1; pointer-events: none; }
        .flower {
            position: absolute; bottom: -150px; width: 50px; height: 50px;
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="rgba(255,255,255,0.8)"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zM12 6c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm0 10c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm-4-5c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2zm8 0c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2z"/></svg>');
            background-size: contain; animation: rise 20s infinite ease-in; opacity: 0;
        }
        @keyframes rise { 0% { transform: translateY(0) rotate(0deg); opacity: 0; } 10% { opacity: 1; } 90% { opacity: 1; } 100% { transform: translateY(-120vh) rotate(720deg); opacity: 0; } }
        .content-wrapper {
            position: relative;
            z-index: 1;
            background-color: transparent;
        }
        .font-serif { font-family: 'Playfair Display', serif; }
        .view-btn.active { background-color: #EC4899; color: white; box-shadow: 0 4px 14px -2px rgba(236, 72, 153, 0.4); }
        .calendar-day-month { transition: all 0.2s ease; }
        .calendar-day-month:hover { transform: scale(1.05); box-shadow: 0 0 20px rgba(0,0,0,0.05); z-index: 10; }
        .current-day .day-number { background-color: #EC4899; color: white; box-shadow: 0 4px 14px -2px rgba(236, 72, 153, 0.4); }
        .modal-enter { opacity: 0; transform: translateY(100%); }
        .modal-enter-active { opacity: 1; transform: translateY(0); transition: all 300ms cubic-bezier(0.4, 0, 0.2, 1); }
        .modal-leave { opacity: 1; transform: translateY(0); }
        .modal-leave-active { opacity: 0; transform: translateY(100%); transition: all 300ms cubic-bezier(0.4, 0, 0.2, 1); }
        .symptom-category-btn.active { background-color: #FDF2F8; border-color: #FBCFE8; color: #DB2777; }
        .symptom-btn.selected { background-color: #EC4899; color: white; border-color: #EC4899; box-shadow: 0 4px 14px -2px rgba(236, 72, 153, 0.4); }
        details > summary { list-style: none; }
        details > summary::-webkit-details-marker { display: none; }
        details[open] summary .accordion-arrow { transform: rotate(180deg); }
    </style>
</head>
<body class="antialiased text-gray-800">

    <div class="animated-background"></div>
    <div id="flower-container"></div>

    <div class="content-wrapper">
        <div id="app-container" class="container mx-auto p-4 md:p-8 max-w-7xl">
            
            <header class="text-center py-16 md:py-24">
                <div id="logo-container" class="flex justify-center items-center text-pink-500 mb-4">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-20 w-20" viewBox="0 0 24 24" fill="currentColor"><path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/></svg>
                </div>
                <h1 class="font-serif text-5xl md:text-7xl font-bold text-gray-800 tracking-tight">Health Diary</h1>
                <p class="text-gray-500 mt-4 text-lg max-w-2xl mx-auto">A revolutionary tool to understand your body's patterns, advocate for your health, and cultivate well-being. ‚ô°</p>
                <a href="#calendar-section" class="inline-block mt-8 px-8 py-3 bg-pink-500 text-white font-semibold rounded-full shadow-lg hover:bg-pink-600 transition-all transform hover:scale-105">
                    Begin Your Journey
                </a>
            </header>

            <main id="calendar-section">
                <div id="streak-container" class="mb-8 text-center bg-amber-50 border-2 border-amber-200 rounded-2xl p-6 max-w-sm mx-auto">
                    <!-- Streak counter will be rendered here -->
                </div>
                <div class="bg-white/70 backdrop-blur-lg rounded-2xl shadow-md p-4 mb-8 flex flex-col md:flex-row items-center justify-between gap-4">
                    <div class="flex items-center gap-4">
                        <button id="prev-btn" class="p-2 rounded-full hover:bg-gray-100 transition-colors"><svg class="h-6 w-6 text-gray-500" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" /></svg></button>
                        <h2 id="current-range-display" class="text-xl md:text-2xl font-bold text-gray-800 text-center w-64"></h2>
                        <button id="next-btn" class="p-2 rounded-full hover:bg-gray-100 transition-colors"><svg class="h-6 w-6 text-gray-500" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" /></svg></button>
                    </div>
                    <div class="bg-gray-100 p-1 rounded-full flex items-center gap-1">
                        <button data-view="month" class="view-btn px-4 py-1.5 text-sm font-semibold rounded-full transition-colors active">Month</button>
                        <button data-view="2-week" class="view-btn px-4 py-1.5 text-sm font-semibold rounded-full transition-colors">2-Week</button>
                        <button data-view="week" class="view-btn px-4 py-1.5 text-sm font-semibold rounded-full transition-colors">Week</button>
                    </div>
                </div>
                <div id="calendar-container" class="bg-white/70 backdrop-blur-lg rounded-2xl shadow-lg p-6 min-h-[600px]"></div>
            </main>

            <section id="insights-section" class="py-16 md:py-24">
                <div class="text-center mb-12">
                    <h2 class="font-serif text-4xl md:text-5xl font-bold text-gray-800">Your Health Insights</h2>
                    <p class="text-gray-500 mt-3 text-lg max-w-2xl mx-auto">Discover patterns and trends from your logged data.</p>
                    <button id="generate-insights-btn" class="mt-6 px-8 py-3 bg-white text-pink-500 border border-pink-200 font-semibold rounded-full shadow-sm hover:bg-pink-50 transition-all transform hover:scale-105">Analyze My Data</button>
                </div>
                <div id="insights-results" class="max-w-4xl mx-auto"></div>
            </section>

            <section class="py-16 md:py-24">
                <div class="text-center mb-12">
                    <h2 class="font-serif text-4xl md:text-5xl font-bold text-gray-800">Empowerment Through Information</h2>
                    <p class="text-gray-500 mt-3 text-lg max-w-2xl mx-auto">Understanding your health is the first step toward advocating for it.</p>
                </div>
                <div class="max-w-3xl mx-auto space-y-4">
                    <details class="bg-white/70 backdrop-blur-lg p-6 rounded-2xl shadow-md group"><summary class="flex justify-between items-center cursor-pointer"><h3 class="font-bold text-xl text-pink-600">The Power of Symptom Tracking</h3><svg class="accordion-arrow h-6 w-6 text-pink-600 transition-transform duration-300" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" /></svg></summary><p class="text-gray-600 mt-4">Systematically logging symptoms provides tangible data, helping you and your healthcare providers identify patterns related to cyclical, dietary, or lifestyle factors. This data-driven approach facilitates more productive medical consultations and personalized care strategies.</p></details>
                    <details class="bg-white/70 backdrop-blur-lg p-6 rounded-2xl shadow-md group"><summary class="flex justify-between items-center cursor-pointer"><h3 class="font-bold text-xl text-pink-600">Best Practices for Data Integrity</h3><svg class="accordion-arrow h-6 w-6 text-pink-600 transition-transform duration-300" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" /></svg></summary><p class="text-gray-600 mt-4">For optimal pattern recognition, establish a consistent daily logging routine. Accuracy is paramount; record observations honestly and without judgment. The goal is to build a comprehensive dataset that accurately reflects your physiological and emotional state over time.</p></details>
                    <details class="bg-white/70 backdrop-blur-lg p-6 rounded-2xl shadow-md group"><summary class="flex justify-between items-center cursor-pointer"><h3 class="font-bold text-xl text-pink-600">Privacy & Data Security</h3><svg class="accordion-arrow h-6 w-6 text-pink-600 transition-transform duration-300" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" /></svg></summary><p class="text-gray-600 mt-4">Your health data is confidential. All information entered into this application is stored exclusively on your device using secure browser local storage. We do not collect, transmit, or share your personal data, ensuring complete privacy and user control.</p></details>
                </div>
            </section>
        </div>
    </div>

    <footer class="text-center py-8 border-t border-gray-200/50"><p class="text-gray-500 mt-1">Made with ‚ù§Ô∏è</p><p class="text-gray-500 mt-1">Blazinik</p></footer>

    <div id="symptom-modal" class="fixed inset-0 bg-white z-50 transform transition-all duration-300 hidden">
        <div class="w-full h-full flex flex-col max-w-4xl mx-auto">
            <div class="p-6 flex justify-between items-center flex-shrink-0">
                <div><h3 class="text-2xl font-bold text-gray-900">Log Your Health Data</h3><p id="modal-date" class="text-gray-500 text-lg"></p></div>
                <button id="close-modal" class="p-2 rounded-full hover:bg-gray-100 transition-colors"><svg class="h-7 w-7 text-gray-600" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" /></svg></button>
            </div>
            <div class="flex-grow p-6 overflow-y-auto">
                <div id="symptom-category-container" class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4 mb-8"></div>
                <div id="symptom-selection-container"></div>
            </div>
            <div class="p-6 bg-gray-50/80 border-t border-gray-200 flex justify-end space-x-3 flex-shrink-0">
                <button id="cancel-btn" class="px-6 py-3 rounded-xl text-md font-semibold text-gray-700 bg-white hover:bg-gray-100 border border-gray-300 transition-all">Cancel</button>
                <button id="save-btn" class="px-6 py-3 rounded-xl text-md font-semibold text-white bg-pink-500 hover:bg-pink-600 transition-all shadow-md hover:shadow-lg hover:shadow-pink-500/30">Save Changes</button>
            </div>
        </div>
    </div>
    
    <script>
    document.addEventListener('DOMContentLoaded', () => {
        let currentDate = new Date();
        let selectedDate = null;
        let currentView = 'month';
        let healthData = {};
        let symptomToCategoryMap = {};
        let modalSymptomState = new Set();

        // DOM Elements
        const streakContainer = document.getElementById('streak-container');
        const calendarContainer = document.getElementById('calendar-container');
        const currentRangeDisplay = document.getElementById('current-range-display');
        const prevBtn = document.getElementById('prev-btn');
        const nextBtn = document.getElementById('next-btn');
        const viewBtns = document.querySelectorAll('.view-btn');
        const modal = document.getElementById('symptom-modal');
        const closeModalBtn = document.getElementById('close-modal');
        const modalDate = document.getElementById('modal-date');
        const symptomCategoryContainer = document.getElementById('symptom-category-container');
        const symptomSelectionContainer = document.getElementById('symptom-selection-container');
        const saveBtn = document.getElementById('save-btn');
        const cancelBtn = document.getElementById('cancel-btn');
        const generateInsightsBtn = document.getElementById('generate-insights-btn');
        const insightsResults = document.getElementById('insights-results');

        // Data
        const symptoms = {
            "Mood": { icon: 'üòä', items: ["Anxiety", "Depression", "Agitation", "Anger", "Irritability", "Moodiness", "Apathy"] },
            "Energy": { icon: '‚ö°Ô∏è', items: ["Fatigue", "Adrenaline", "Disturbances", "Stamina"] },
            "Sleep": { icon: 'üò¥', items: ["Insomnia", "Restlessness", "Overslept", "Woke up tired"] },
            "Aches/Pains": { icon: 'ü§ï', items: ["Joint Pain", "Feet Swelling", "Abdominal pain", "Ankle pain", "Muscle aches", "Back Pain", "Muscle Cramps"] },
            "Digestion": { icon: 'ÔøΩ', items: ["Indigestion", "Constipation", "Acid Reflux", "Diarrhea", "Nausea", "Bloating"] },
            "Brain": { icon: 'üß†', items: ["Concentration", "Headache", "Dizziness", "Clarity", "Memory", "Brain Fog", "Migraine"] },
            "Skin/Hair": { icon: 'üíÖ', items: ["Bruising", "Brittle Hair", "Dry Skin", "Acne", "Hair Loss", "Perspiration"] },
            "Women's Health": { icon: 'üå∏', items: ["Libido", "Menstruation Pain", "Confidence", "Too cold", "Sweating", "Breast ache", "Too hot"] },
        };

        const symptomInsights = {
            'Headache': 'Frequent headaches can be linked to dehydration, stress, or lack of sleep. Consider your daily habits.',
            'Fatigue': 'Persistent fatigue may suggest a need for more restorative sleep or a review of your diet for energy-rich foods.',
            'Bloating': 'Recurring bloating could be related to specific foods. You might consider noting your meals alongside your symptoms.',
            'Anxiety': 'Feelings of anxiety can sometimes be linked to caffeine intake, stress levels, or lack of physical activity.',
            'Insomnia': 'Difficulty sleeping can be influenced by screen time before bed or stress. A consistent wind-down routine may help.',
            'Joint Pain': 'Recurring joint pain can sometimes be associated with inflammatory foods or weather changes. Note any correlations.',
            'Menstruation Pain': 'Tracking pain alongside your cycle can reveal patterns that are useful to discuss with a healthcare provider.',
            'Acne': 'Hormonal fluctuations are a common cause of acne. Noting breakouts in the calendar can help visualize this pattern.',
            'Brain Fog': 'Difficulty concentrating can be related to sleep quality, diet, or stress. Tracking these factors may reveal connections.'
        };

        // Functions
        const formatDate = (date) => date.toISOString().split('T')[0];
        
        const mapSymptomsToCategories = () => {
            symptomToCategoryMap = {};
            for (const category in symptoms) {
                symptoms[category].items.forEach(item => { symptomToCategoryMap[item] = category; });
            }
        };

        const calculateStreak = () => {
            let streak = 0;
            const today = new Date();
            const todayStr = formatDate(today);
            
            if (healthData[todayStr] && healthData[todayStr].length > 0) {
                streak = 1;
                const yesterday = new Date(today);
                yesterday.setDate(today.getDate() - 1);
                while (healthData[formatDate(yesterday)] && healthData[formatDate(yesterday)].length > 0) {
                    streak++;
                    yesterday.setDate(yesterday.getDate() - 1);
                }
            }
            streakContainer.innerHTML = `<div class="font-bold text-5xl text-amber-500">${streak}</div><div class="text-lg font-semibold text-gray-600 mt-1">Day Streak</div><p class="text-sm text-gray-500 mt-2">Keep it going! Consistency is key to understanding your health.</p>`;
        };

        const renderApp = () => {
            if (currentView === 'month') renderMonthView();
            else if (currentView === '2-week') renderWeekView(14);
            else if (currentView === 'week') renderWeekView(7);
            calculateStreak();
        };

        const renderMonthView = () => {
            calendarContainer.innerHTML = '';
            const year = currentDate.getFullYear();
            const month = currentDate.getMonth();
            currentRangeDisplay.textContent = `${currentDate.toLocaleString('default', { month: 'long' })} ${year}`;
            const header = `<div class="grid grid-cols-7 gap-4 text-center font-semibold text-gray-400 text-sm mb-3">${['SUN', 'MON', 'TUE', 'WED', 'THU', 'FRI', 'SAT'].map(d => `<div>${d}</div>`).join('')}</div>`;
            const grid = document.createElement('div');
            grid.className = 'grid grid-cols-7 gap-4';
            for (let i = 0; i < new Date(year, month, 1).getDay(); i++) grid.appendChild(document.createElement('div'));
            for (let day = 1; day <= new Date(year, month + 1, 0).getDate(); day++) {
                const date = new Date(year, month, day);
                const dateStr = formatDate(date);
                const dayData = healthData[dateStr] || [];
                const icons = getIconsForDay(dayData);
                const intensity = Math.min(dayData.length / 5, 1);
                const bgColor = dayData.length > 0 ? `rgba(236, 72, 153, ${0.1 + intensity * 0.5})` : 'transparent';
                const dayCell = document.createElement('div');
                dayCell.className = 'calendar-day-month relative h-24 bg-white rounded-xl border border-gray-100 cursor-pointer p-2 flex flex-col justify-between';
                dayCell.style.backgroundColor = bgColor;
                dayCell.dataset.date = dateStr;
                dayCell.innerHTML = `<span class="day-number h-7 w-7 flex items-center justify-center rounded-full text-sm font-medium ml-auto ${formatDate(new Date()) === dateStr ? 'current-day' : ''}">${day}</span><div class="flex items-center gap-1 text-sm">${icons.slice(0, 3).map(icon => `<span>${icon}</span>`).join('')}${icons.length > 3 ? `<span class="text-xs font-bold text-pink-700">+${icons.length - 3}</span>` : ''}</div>`;
                dayCell.addEventListener('click', () => openModal(dateStr));
                grid.appendChild(dayCell);
            }
            calendarContainer.innerHTML = header;
            calendarContainer.appendChild(grid);
        };
        
        const getIconsForDay = (dayData) => {
            if (!dayData || dayData.length === 0) return [];
            const categories = new Set(dayData.map(symptom => symptomToCategoryMap[symptom]));
            return Array.from(categories).map(cat => symptoms[cat]?.icon || '').filter(Boolean);
        };

        const renderWeekView = (numDays) => {
            calendarContainer.innerHTML = '';
            const grid = document.createElement('div');
            grid.className = `grid grid-cols-1 md:grid-cols-4 lg:grid-cols-7 gap-4`;
            
            let startDate = new Date(currentDate);
            const dayOfWeek = startDate.getDay();
            startDate.setDate(startDate.getDate() - dayOfWeek);

            const endDate = new Date(startDate);
            endDate.setDate(startDate.getDate() + numDays - 1);
            currentRangeDisplay.textContent = `${startDate.toLocaleDateString('default', { month: 'short', day: 'numeric' })} - ${endDate.toLocaleDateString('default', { month: 'short', day: 'numeric' })}`;
            
            for (let i = 0; i < numDays; i++) {
                const day = new Date(startDate);
                day.setDate(startDate.getDate() + i);
                const dateStr = formatDate(day);
                const dayData = healthData[dateStr] || [];
                const icons = getIconsForDay(dayData);
                const dayCell = document.createElement('div');
                dayCell.className = 'bg-white rounded-xl border border-gray-100 cursor-pointer p-4 flex flex-col min-h-[200px]';
                dayCell.dataset.date = dateStr;
                dayCell.innerHTML = `<div class="flex justify-between items-center mb-3"><span class="font-bold text-gray-500 text-sm">${day.toLocaleDateString('default', { weekday: 'short' }).toUpperCase()}</span><span class="day-number h-7 w-7 flex items-center justify-center rounded-full text-sm font-medium ${formatDate(new Date()) === dateStr ? 'current-day' : ''}">${day.getDate()}</span></div><div class="flex-grow space-y-1 overflow-hidden flex flex-wrap gap-2 content-start">${icons.length > 0 ? icons.map(icon => `<div class="text-lg bg-pink-50 rounded-md h-8 w-8 flex items-center justify-center">${icon}</div>`).join('') : `<p class="text-xs text-gray-400 w-full">No data logged.</p>`}</div>`;
                dayCell.addEventListener('click', () => openModal(dateStr));
                grid.appendChild(dayCell);
            }
            calendarContainer.appendChild(grid);
        };

        const openModal = (dateStr) => {
            selectedDate = dateStr;
            modalSymptomState = new Set(healthData[selectedDate] || []);
            const date = new Date(dateStr + 'T00:00:00');
            modalDate.textContent = date.toLocaleDateString('en-US', { weekday: 'long', month: 'long', day: 'numeric' });
            renderModalCategories();
            modal.classList.remove('hidden', 'modal-leave', 'modal-leave-active');
            modal.classList.add('modal-enter', 'modal-enter-active');
        };

        const closeModal = () => {
            modal.classList.remove('modal-enter', 'modal-enter-active');
            modal.classList.add('modal-leave', 'modal-leave-active');
            setTimeout(() => modal.classList.add('hidden'), 300);
        };

        const renderModalCategories = () => {
            symptomCategoryContainer.innerHTML = '';
            Object.keys(symptoms).forEach((category, index) => {
                const cat = symptoms[category];
                const btn = document.createElement('button');
                btn.className = `symptom-category-btn p-4 rounded-xl border-2 text-left transition-colors ${index === 0 ? 'active' : ''}`;
                btn.innerHTML = `<span class="text-2xl">${cat.icon}</span><h4 class="font-bold mt-2">${category}</h4>`;
                btn.addEventListener('click', () => {
                    document.querySelector('.symptom-category-btn.active')?.classList.remove('active');
                    btn.classList.add('active');
                    renderSymptomSelection(category);
                });
                symptomCategoryContainer.appendChild(btn);
            });
            renderSymptomSelection(Object.keys(symptoms)[0]);
        };
        
        const renderSymptomSelection = (category) => {
            symptomSelectionContainer.innerHTML = '';
            const items = symptoms[category].items;
            const grid = document.createElement('div');
            grid.className = 'flex flex-wrap gap-3';
            items.forEach(item => {
                const button = document.createElement('button');
                button.className = `symptom-btn px-4 py-2.5 rounded-lg text-sm font-semibold text-gray-800 bg-white hover:bg-gray-50 border ${modalSymptomState.has(item) ? 'selected' : ''}`;
                button.textContent = item;
                button.addEventListener('click', () => {
                    button.classList.toggle('selected');
                    if (modalSymptomState.has(item)) modalSymptomState.delete(item);
                    else modalSymptomState.add(item);
                });
                grid.appendChild(button);
            });
            symptomSelectionContainer.appendChild(grid);
        };

        const saveSymptoms = () => {
            healthData[selectedDate] = Array.from(modalSymptomState);
            if (healthData[selectedDate].length === 0) delete healthData[selectedDate];
            localStorage.setItem('healthTrackerData', JSON.stringify(healthData));
            closeModal();
            renderApp();
        };

        const analyzeHealthData = () => {
            const dataEntries = Object.values(healthData).filter(arr => arr.length > 0);
            if (dataEntries.length < 3) {
                insightsResults.innerHTML = `<div class="text-center text-gray-500 bg-white/70 backdrop-blur-lg p-8 rounded-2xl shadow-md"><p>Log at least 3 days of data to generate insights.</p><p class="text-sm mt-2">The more you track, the smarter your insights will be!</p></div>`;
                return;
            }
            const symptomCounts = {};
            const dayOfWeekCounts = { 0:0, 1:0, 2:0, 3:0, 4:0, 5:0, 6:0 };
            const days = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];
            for (const dateStr in healthData) {
                const date = new Date(dateStr + 'T00:00:00');
                if (healthData[dateStr] && healthData[dateStr].length > 0) dayOfWeekCounts[date.getDay()]++;
                healthData[dateStr].forEach(symptom => { symptomCounts[symptom] = (symptomCounts[symptom] || 0) + 1; });
            }
            const sortedSymptoms = Object.entries(symptomCounts).sort((a, b) => b[1] - a[1]);
            const topSymptoms = sortedSymptoms.slice(0, 5);
            const busiestDayIndex = Object.keys(dayOfWeekCounts).reduce((a, b) => dayOfWeekCounts[a] > dayOfWeekCounts[b] ? a : b);
            const busiestDay = days[busiestDayIndex];
            renderInsights({ topSymptoms, busiestDay });
        };

        const renderInsights = ({ topSymptoms, busiestDay }) => {
            const speculativeInsights = topSymptoms.map(([symptom]) => symptomInsights[symptom]).filter(Boolean);
            insightsResults.innerHTML = `
                <div class="grid md:grid-cols-2 gap-8">
                    <div class="bg-white/70 backdrop-blur-lg p-8 rounded-2xl shadow-md">
                        <h3 class="font-bold text-xl text-pink-600 mb-4">Most Frequent Symptoms</h3>
                        <ul class="space-y-3">
                            ${topSymptoms.map(([symptom, count]) => `
                                <li class="flex justify-between items-center">
                                    <span class="font-medium text-gray-700">${symptom}</span>
                                    <span class="text-sm font-semibold text-gray-500 bg-pink-50 px-3 py-1 rounded-full">${count} days</span>
                                </li>
                            `).join('')}
                        </ul>
                    </div>
                    <div class="bg-white/70 backdrop-blur-lg p-8 rounded-2xl shadow-md">
                        <h3 class="font-bold text-xl text-pink-600 mb-4">Weekly Pattern</h3>
                        <div class="text-center"><p class="text-gray-600">You log the most symptoms on</p><p class="font-bold text-3xl text-gray-800 mt-2">${busiestDay}s</p><p class="text-sm text-gray-500 mt-2">Consider paying extra attention to your well-being on this day.</p></div>
                    </div>
                </div>
                ${speculativeInsights.length > 0 ? `
                <div class="bg-white/70 backdrop-blur-lg p-8 rounded-2xl shadow-md mt-8">
                    <h3 class="font-bold text-xl text-pink-600 mb-4">Potential Patterns</h3>
                    <ul class="space-y-3 list-disc list-inside text-gray-600">${speculativeInsights.map(insight => `<li>${insight}</li>`).join('')}</ul>
                    <p class="text-xs text-gray-400 mt-4"><strong>Disclaimer:</strong> This is not medical advice. These are general observations to help you notice patterns. Always consult a healthcare professional for any health concerns.</p>
                </div>` : ''}
            `;
        };
        
        const createFlowers = () => {
            const container = document.getElementById('flower-container');
            if (!container) return;
            for (let i = 0; i < 15; i++) {
                const flower = document.createElement('div');
                flower.classList.add('flower');
                flower.style.left = `${Math.random() * 100}vw`;
                flower.style.animationDuration = `${Math.random() * 8 + 12}s`;
                flower.style.animationDelay = `${Math.random() * 10}s`;
                const size = Math.random() * 30 + 20;
                flower.style.width = `${size}px`;
                flower.style.height = `${size}px`;
                container.appendChild(flower);
            }
        };

        // Event Listeners
        viewBtns.forEach(btn => btn.addEventListener('click', () => { document.querySelector('.view-btn.active').classList.remove('active'); btn.classList.add('active'); currentView = btn.dataset.view; renderApp(); }));
        prevBtn.addEventListener('click', () => { 
            if (currentView === 'month') {
                currentDate.setMonth(currentDate.getMonth() - 1);
            } else {
                let currentStartDate = new Date(currentDate);
                currentStartDate.setDate(currentStartDate.getDate() - currentStartDate.getDay());
                currentStartDate.setDate(currentStartDate.getDate() - (currentView === '2-week' ? 14 : 7));
                currentDate = currentStartDate;
            }
            renderApp(); 
        });
        nextBtn.addEventListener('click', () => { 
            if (currentView === 'month') {
                currentDate.setMonth(currentDate.getMonth() + 1);
            } else {
                let currentStartDate = new Date(currentDate);
                currentStartDate.setDate(currentStartDate.getDate() - currentStartDate.getDay());
                currentStartDate.setDate(currentStartDate.getDate() + (currentView === '2-week' ? 14 : 7));
                currentDate = currentStartDate;
            }
            renderApp(); 
        });
        closeModalBtn.addEventListener('click', closeModal);
        cancelBtn.addEventListener('click', closeModal);
        saveBtn.addEventListener('click', saveSymptoms);
        generateInsightsBtn.addEventListener('click', analyzeHealthData);
        document.addEventListener('keydown', (e) => { if (e.key === "Escape" && !modal.classList.contains('hidden')) closeModal(); });

        // Initialization
        const savedData = localStorage.getItem('healthTrackerData');
        if (savedData) healthData = JSON.parse(savedData);
        mapSymptomsToCategories();
        renderApp();
        createFlowers();
    });
    </script>
</body>
</html>
