<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Power Plant Control Simulator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&family=Orbitron:wght@400;700&display=swap" rel="stylesheet">
    <style>
        /* Custom styles */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #1a202c; /* Dark background */
            color: #e2e8f0; /* Light text */
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 1rem;
            overflow: hidden; /* Prevent scrollbars during explosion */
        }
        .control-panel {
            background-color: #2d3748; /* Slightly lighter dark */
            border-radius: 0.75rem; /* Rounded corners */
            padding: 2rem;
            border: 2px solid #4a5568;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.3), 0 4px 6px -2px rgba(0, 0, 0, 0.15);
            width: 100%;
            max-width: 800px; /* Max width for the panel */
        }
        .screen {
            background-color: #000;
            color: #0f0; /* Green digital text */
            font-family: 'Orbitron', sans-serif; /* Digital-style font */
            padding: 0.75rem 1rem;
            border-radius: 0.375rem; /* Slightly rounded */
            border: 1px solid #38a169; /* Green border */
            text-align: right;
            font-size: 1.5rem; /* Larger font size */
            box-shadow: inset 0 2px 4px 0 rgba(0, 255, 0, 0.1);
            margin-bottom: 1rem;
            min-height: 50px; /* Ensure consistent height */
            display: flex;
            align-items: center;
            justify-content: flex-end;
        }
         .status-screen {
            font-size: 1.25rem; /* Slightly smaller for status */
            text-align: center;
            justify-content: center;
            min-height: 40px;
            margin-top: 1rem;
         }
        .status-stable { color: #68d391; border-color: #68d391; box-shadow: inset 0 2px 4px 0 rgba(104, 211, 145, 0.1); }
        .status-warning { color: #f6e05e; border-color: #f6e05e; animation: pulse-warning 1.5s infinite; box-shadow: inset 0 2px 4px 0 rgba(246, 224, 94, 0.1); }
        .status-danger { color: #fc8181; border-color: #fc8181; animation: pulse-danger 1s infinite; box-shadow: inset 0 2px 4px 0 rgba(252, 129, 129, 0.1); }
        .status-meltdown { color: #fff; background-color: #c53030; border-color: #c53030; animation: blink-danger 0.5s infinite; box-shadow: none; }

        @keyframes pulse-warning {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }
        @keyframes pulse-danger {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
         @keyframes blink-danger {
            0%, 100% { background-color: #c53030; color: #fff; }
            50% { background-color: #e53e3e; color: #eee; }
        }

        /* Custom Switch Style */
        .switch {
            position: relative;
            display: inline-block;
            width: 60px;
            height: 34px;
        }
        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #4a5568; /* Darker grey */
            transition: .4s;
            border-radius: 34px;
        }
        .slider:before {
            position: absolute;
            content: "";
            height: 26px;
            width: 26px;
            left: 4px;
            bottom: 4px;
            background-color: #a0aec0; /* Lighter grey */
            transition: .4s;
            border-radius: 50%;
        }
        input:checked + .slider {
            background-color: #48bb78; /* Green when on */
        }
        input:checked + .slider:before {
            transform: translateX(26px);
            background-color: white;
        }

        /* Custom Dial Style */
        input[type="range"] {
            -webkit-appearance: none;
            appearance: none;
            width: 100%;
            height: 15px;
            background: linear-gradient(to right, #f6e05e, #e53e3e); /* Yellow to Red gradient */
            border-radius: 5px;
            outline: none;
            opacity: 0.9;
            transition: opacity .2s;
            cursor: pointer;
            margin-top: 0.5rem;
        }
        input[type="range"]:hover {
            opacity: 1;
        }
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 25px;
            height: 25px;
            background: #cbd5e0; /* Light grey handle */
            border-radius: 50%;
            cursor: pointer;
            border: 2px solid #4a5568;
        }
        input[type="range"]::-moz-range-thumb {
            width: 25px;
            height: 25px;
            background: #cbd5e0;
            border-radius: 50%;
            cursor: pointer;
            border: 2px solid #4a5568;
        }

        /* Button Style */
        .control-button {
            background-color: #4a5568;
            border: 2px solid #718096;
            color: #e2e8f0;
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            font-weight: 500;
            transition: all 0.2s ease-in-out;
            cursor: pointer;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }
        .control-button:hover {
            background-color: #718096;
            border-color: #a0aec0;
            box-shadow: 0 4px 8px rgba(0,0,0,0.3);
        }
        .control-button:active {
            transform: translateY(1px);
            box-shadow: 0 1px 2px rgba(0,0,0,0.2);
        }
        .control-button:disabled {
             background-color: #2d3748;
             border-color: #4a5568;
             color: #718096;
             cursor: not-allowed;
             opacity: 0.6;
         }

        /* Explosion Overlay */
        #explosion-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle, rgba(255,100,0,0.8) 0%, rgba(200,0,0,0.95) 70%, rgba(50,0,0,1) 100%);
            display: flex;
            flex-direction: column; /* Stack message and button */
            justify-content: center;
            align-items: center;
            z-index: 100;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.5s ease-in-out, visibility 0.5s ease-in-out;
            backdrop-filter: blur(5px); /* Optional blur effect */
        }
        #explosion-overlay.active {
            opacity: 1;
            visibility: visible;
        }
        #explosion-message {
            font-size: 4rem;
            color: white;
            text-shadow: 2px 2px 5px black;
            font-weight: bold;
            font-family: 'Orbitron', sans-serif;
            margin-bottom: 2rem; /* Space before button */
            text-align: center;
        }
        #reset-button {
             background-color: #e2e8f0;
             color: #1a202c;
             padding: 1rem 2rem;
             border-radius: 0.5rem;
             font-size: 1.25rem;
             font-weight: bold;
             cursor: pointer;
             border: none;
             box-shadow: 0 4px 6px rgba(0,0,0,0.3);
             transition: background-color 0.2s;
        }
        #reset-button:hover {
            background-color: #cbd5e0;
        }

        /* Control Labels */
        .control-label {
            font-weight: 500;
            margin-bottom: 0.5rem;
            color: #a0aec0; /* Lighter grey for labels */
            display: block; /* Ensure label is above control */
            text-align: center; /* Center labels */
        }

        /* Layout */
        .controls-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); /* Responsive grid */
            gap: 2rem; /* Gap between controls */
            align-items: start; /* Align items to the top */
        }
        .control-group {
            display: flex;
            flex-direction: column;
            align-items: center; /* Center items within the group */
        }
    </style>
</head>
<body>
    <div class="control-panel">
        <h1 class="text-3xl font-bold text-center mb-6 text-yellow-400">Power Plant Control</h1>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
            <div>
                <label class="block text-sm font-medium text-gray-400 mb-1">Power Output (kW)</label>
                <div id="power-output" class="screen">0</div>
            </div>
            <div>
                <label class="block text-sm font-medium text-gray-400 mb-1">Core Temperature (Â°C)</label>
                <div id="temperature" class="screen">20</div>
            </div>
        </div>

        <div>
             <label class="block text-sm font-medium text-gray-400 mb-1 text-center">System Status</label>
             <div id="system-status" class="screen status-screen status-stable">OFFLINE</div>
         </div>

        <div class="mt-8 pt-6 border-t border-gray-600">
            <h2 class="text-xl font-semibold text-center mb-6 text-gray-300">Controls</h2>
            <div class="controls-grid">
                <div class="control-group">
                    <label for="main-power" class="control-label">Main Power</label>
                    <label class="switch">
                        <input type="checkbox" id="main-power">
                        <span class="slider"></span>
                    </label>
                </div>

                <div class="control-group">
                    <label for="coolant-pump" class="control-label">Coolant Pump</label>
                    <label class="switch">
                        <input type="checkbox" id="coolant-pump" disabled> <span class="slider"></span>
                    </label>
                </div>

                <div class="control-group">
                    <label for="reactor-level" class="control-label">Reactor Level (%)</label>
                    <input type="range" id="reactor-level" min="0" max="100" value="0" disabled> <span id="reactor-level-value" class="text-sm text-gray-400 mt-1">0%</span>
                </div>

                 <div class="control-group">
                    <label for="emergency-vent" class="control-label">Emergency Vent</label>
                    <button id="emergency-vent" class="control-button" disabled>VENT</button>
                </div>
            </div>
        </div>
    </div>

    <div id="explosion-overlay">
        <div id="explosion-message">MELTDOWN!</div>
        <button id="reset-button">Restart Simulation</button>
    </div>

    <script>
        // --- DOM Elements ---
        const mainPowerSwitch = document.getElementById('main-power');
        const coolantPumpSwitch = document.getElementById('coolant-pump');
        const reactorLevelDial = document.getElementById('reactor-level');
        const reactorLevelValue = document.getElementById('reactor-level-value');
        const emergencyVentButton = document.getElementById('emergency-vent');

        const powerOutputDisplay = document.getElementById('power-output');
        const temperatureDisplay = document.getElementById('temperature');
        const systemStatusDisplay = document.getElementById('system-status');

        const explosionOverlay = document.getElementById('explosion-overlay');
        const resetButton = document.getElementById('reset-button');

        // --- Game State Variables ---
        let gameState = {
            mainPower: false,
            coolantPump: false,
            reactorLevel: 0, // percentage
            powerOutput: 0, // kW
            temperature: 20, // degrees C
            status: 'OFFLINE', // OFFLINE, STABLE, WARNING, DANGER, MELTDOWN
            ventCooldown: 0, // Seconds remaining for vent cooldown
            isMeltdown: false
        };

        // --- Game Constants ---
        const TEMP_BASE_INCREASE = 0.1; // Base temp increase per tick when reactor is off but power is on
        const TEMP_REACTOR_MULTIPLIER = 0.15; // Temp increase per % of reactor level
        const TEMP_COOLANT_REDUCTION = 0.5; // Factor by which coolant reduces temp increase
        const TEMP_VENT_REDUCTION = 50; // Instant temp reduction from vent
        const POWER_REACTOR_MULTIPLIER = 15; // Power generated per % of reactor level
        const WARNING_TEMP = 400;
        const DANGER_TEMP = 700;
        const MELTDOWN_TEMP = 900;
        const VENT_COOLDOWN_TIME = 10; // seconds
        const GAME_TICK_INTERVAL = 200; // milliseconds (5 times per second)

        // --- Game Loop ---
        let gameInterval = null;

        function startGameLoop() {
            if (gameInterval) clearInterval(gameInterval); // Clear existing loop if any
            gameInterval = setInterval(updateGame, GAME_TICK_INTERVAL);
            console.log("Game loop started");
        }

        function stopGameLoop() {
            clearInterval(gameInterval);
            gameInterval = null;
            console.log("Game loop stopped");
        }

        // --- Update Function (Called every tick) ---
        function updateGame() {
            if (gameState.isMeltdown) return; // Stop updates if meltdown occurred

            let tempIncrease = 0;

            // --- Calculate Temperature Change ---
            if (gameState.mainPower) {
                // Base temperature increase just by being online
                tempIncrease += TEMP_BASE_INCREASE;

                // Temperature increase from reactor
                tempIncrease += gameState.reactorLevel * TEMP_REACTOR_MULTIPLIER;

                // Coolant reduces temperature increase
                if (gameState.coolantPump) {
                    tempIncrease *= (1 - TEMP_COOLANT_REDUCTION);
                }

                gameState.temperature += tempIncrease;

            } else {
                // Gradual cooldown when offline
                if (gameState.temperature > 20) {
                    gameState.temperature -= 0.5;
                } else {
                    gameState.temperature = 20;
                }
            }

             // Clamp temperature minimum
             if (gameState.temperature < 20) {
                 gameState.temperature = 20;
             }


            // --- Calculate Power Output ---
            if (gameState.mainPower && gameState.reactorLevel > 0) {
                // Power generation depends on reactor level, but also slightly affected by high temp (less efficient)
                let efficiency = 1;
                if (gameState.temperature > DANGER_TEMP) {
                    efficiency = 0.8; // Reduced efficiency in danger zone
                } else if (gameState.temperature > WARNING_TEMP) {
                    efficiency = 0.95; // Slightly reduced efficiency in warning zone
                }
                gameState.powerOutput = Math.round(gameState.reactorLevel * POWER_REACTOR_MULTIPLIER * efficiency);
            } else {
                gameState.powerOutput = 0;
            }

            // --- Update Status ---
            if (!gameState.mainPower) {
                gameState.status = 'OFFLINE';
            } else if (gameState.temperature >= MELTDOWN_TEMP) {
                gameState.status = 'MELTDOWN';
                triggerMeltdown();
            } else if (gameState.temperature >= DANGER_TEMP) {
                gameState.status = 'DANGER';
            } else if (gameState.temperature >= WARNING_TEMP) {
                gameState.status = 'WARNING';
            } else {
                gameState.status = 'STABLE';
            }

            // --- Update Vent Cooldown ---
            if (gameState.ventCooldown > 0) {
                gameState.ventCooldown -= GAME_TICK_INTERVAL / 1000; // Decrease cooldown timer
                if (gameState.ventCooldown <= 0) {
                    gameState.ventCooldown = 0;
                    emergencyVentButton.disabled = !gameState.mainPower; // Re-enable if power is on
                    emergencyVentButton.textContent = "VENT";
                } else {
                     emergencyVentButton.textContent = `VENT (${Math.ceil(gameState.ventCooldown)}s)`;
                }
            }

            // --- Update UI ---
            updateUI();
        }

        // --- UI Update Function ---
        function updateUI() {
            powerOutputDisplay.textContent = gameState.powerOutput;
            temperatureDisplay.textContent = Math.round(gameState.temperature);
            reactorLevelValue.textContent = `${gameState.reactorLevel}%`;

            // Update Status Display Class
            systemStatusDisplay.textContent = gameState.status;
            systemStatusDisplay.className = 'screen status-screen'; // Reset classes
            switch (gameState.status) {
                case 'STABLE':
                    systemStatusDisplay.classList.add('status-stable');
                    break;
                case 'WARNING':
                    systemStatusDisplay.classList.add('status-warning');
                    break;
                case 'DANGER':
                    systemStatusDisplay.classList.add('status-danger');
                    break;
                case 'MELTDOWN':
                    systemStatusDisplay.classList.add('status-meltdown');
                    break;
                case 'OFFLINE':
                default:
                     systemStatusDisplay.classList.add('status-stable'); // Use stable style for offline
                     systemStatusDisplay.textContent = 'OFFLINE'; // Ensure text is OFFLINE
                     break;
            }

            // Update control enabled states based on main power
            coolantPumpSwitch.disabled = !gameState.mainPower || gameState.isMeltdown;
            reactorLevelDial.disabled = !gameState.mainPower || gameState.isMeltdown;
            // Vent button is disabled during cooldown OR if power is off OR during meltdown
            emergencyVentButton.disabled = gameState.ventCooldown > 0 || !gameState.mainPower || gameState.isMeltdown;
             if (gameState.ventCooldown > 0 && !gameState.isMeltdown) {
                 emergencyVentButton.textContent = `VENT (${Math.ceil(gameState.ventCooldown)}s)`;
             } else if (!gameState.isMeltdown) {
                 emergencyVentButton.textContent = "VENT";
             }

             // Ensure controls reflect state (important for reset)
             mainPowerSwitch.checked = gameState.mainPower;
             coolantPumpSwitch.checked = gameState.coolantPump;
             reactorLevelDial.value = gameState.reactorLevel;
        }

        // --- Event Listeners ---
        mainPowerSwitch.addEventListener('change', (event) => {
            gameState.mainPower = event.target.checked;
            console.log("Main Power:", gameState.mainPower);
            if (gameState.mainPower) {
                // If turning on, start the game loop
                startGameLoop();
                gameState.status = 'STABLE'; // Initial status when turned on
            } else {
                // If turning off, reset relevant states
                gameState.coolantPump = false;
                gameState.reactorLevel = 0;
                gameState.powerOutput = 0;
                // Don't stop the loop immediately, let it cool down
                // stopGameLoop(); // Optionally stop loop instantly
              