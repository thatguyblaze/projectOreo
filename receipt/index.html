<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sector 9-X Control Interface - Mk III</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Share+Tech+Mono&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.8.49/Tone.js"></script>
    <style>
        :root {
            --glow-color-green: #0afa0a;
            --glow-color-blue: #60a5fa;
            --glow-color-yellow: #facc15;
            --glow-color-red: #f87171;
            --glow-color-cyan: #22d3ee;
            --bg-dark: #111827; /* Tailwind gray-900 */
            --bg-medium: #1f2937; /* Tailwind gray-800 */
            --bg-light: #374151; /* Tailwind gray-700 */
            --border-color: #4b5563; /* Tailwind gray-600 */
        }

        body {
            font-family: 'Share Tech Mono', monospace;
            background-color: var(--bg-dark);
            color: var(--glow-color-green);
            overflow: hidden;
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 1rem;
        }

        .control-panel-bg {
            background: var(--bg-medium);
            border: 1px solid var(--border-color);
            box-shadow: inset 0 0 20px rgba(0,0,0,0.7), 0 0 15px rgba(0,0,0,0.5);
            border-radius: 12px;
            padding: 20px;
            width: 100%;
            max-width: 1500px;
            height: 95vh;
            display: flex;
            flex-direction: column;
        }

        .screen {
            background-color: #050a05;
            border: 1px solid #00ff0040;
            box-shadow: inset 0 0 15px #00ff0020;
            padding: 12px;
            overflow-y: auto;
            border-radius: 6px;
            color: var(--glow-color-green);
            height: 100%;
            font-size: 0.9rem;
            line-height: 1.4;
            white-space: pre-wrap;
            word-wrap: break-word;
            scrollbar-width: thin;
            scrollbar-color: var(--glow-color-green) #050a05;
        }
        .screen::-webkit-scrollbar { width: 8px; }
        .screen::-webkit-scrollbar-track { background: #050a05; }
        .screen::-webkit-scrollbar-thumb { background-color: var(--glow-color-green); border-radius: 4px; border: 2px solid #050a05; }

        .flicker { animation: flicker 0.1s infinite alternate; }
        @keyframes flicker {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.95; filter: brightness(1.1); }
        }

        .scanlines::before {
            content: ""; position: absolute; top: 0; left: 0; right: 0; bottom: 0;
            background: linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.15) 50%);
            background-size: 100% 4px;
            z-index: 2; pointer-events: none;
            animation: scanline-anim 15s linear infinite;
            opacity: 0.4;
        }
        @keyframes scanline-anim {
            0% { background-position: 0 0; }
            100% { background-position: 0 100vh; }
        }

        /* Modern Buttons & Switches */
        .control-button {
            background: linear-gradient(145deg, var(--bg-light), var(--bg-medium));
            border: 1px solid var(--border-color);
            color: #e5e7eb; padding: 10px 18px; border-radius: 6px;
            box-shadow: 0 3px 6px rgba(0,0,0,0.3), inset 0 1px 1px rgba(255,255,255,0.05);
            cursor: pointer; transition: all 0.15s ease;
            text-shadow: 0 1px 1px rgba(0,0,0,0.4); font-weight: bold;
        }
        .control-button:hover { background: linear-gradient(145deg, #4b5563, #2a3341); border-color: #6b7280; color: white; }
        .control-button:active { background: linear-gradient(145deg, #2a3341, #1f2937); box-shadow: inset 0 2px 4px rgba(0,0,0,0.4); transform: translateY(1px); }
        .control-button:disabled { background: var(--bg-medium); color: #6b7280; cursor: not-allowed; opacity: 0.6; box-shadow: inset 0 1px 2px rgba(0,0,0,0.3); }

        .button-glow-green { box-shadow: 0 0 8px var(--glow-color-green), 0 0 15px var(--glow-color-green), inset 0 1px 1px rgba(255,255,255,0.1); }
        .button-glow-red { background: linear-gradient(145deg, #b91c1c, #7f1d1d); border-color: #dc2626; color: #fef2f2; box-shadow: 0 0 10px var(--glow-color-red), 0 0 20px var(--glow-color-red), inset 0 1px 1px rgba(255,255,255,0.1); }
        .button-glow-red:hover { background: linear-gradient(145deg, #dc2626, #991b1b); border-color: #ef4444; }
        .button-glow-red:active { background: linear-gradient(145deg, #991b1b, #7f1d1d); box-shadow: inset 0 2px 4px rgba(0,0,0,0.6); }

        .switch { position: relative; width: 60px; height: 30px; background-color: var(--bg-dark); border-radius: 15px; border: 1px solid var(--border-color); cursor: pointer; box-shadow: inset 0 2px 5px rgba(0,0,0,0.6); transition: background-color 0.3s ease; }
        .switch-handle { position: absolute; width: 24px; height: 24px; background: linear-gradient(145deg, #9ca3af, #6b7280); border-radius: 50%; top: 2px; left: 3px; transition: left 0.3s ease; box-shadow: 0 2px 3px rgba(0,0,0,0.4); }
        .switch.on { background-color: #16a34a; box-shadow: inset 0 2px 5px rgba(0,0,0,0.3), 0 0 10px #16a34a; }
        .switch.on .switch-handle { left: 32px; background: linear-gradient(145deg, #e5e7eb, #b2bbc8); }

        /* Dial */
        .dial-container { text-align: center; }
        .dial { position: relative; width: 100px; height: 100px; border-radius: 50%; background: radial-gradient(circle at center, var(--bg-light) 60%, var(--bg-medium) 100%); border: 2px solid var(--border-color); box-shadow: 0 5px 10px rgba(0,0,0,0.4), inset 0 0 10px rgba(0,0,0,0.5); margin: 0 auto 5px auto; cursor: grab; user-select: none; }
        .dial:active { cursor: grabbing; }
        .dial-indicator { position: absolute; top: 5px; left: 50%; transform: translateX(-50%); width: 4px; height: 15px; background-color: var(--glow-color-yellow); border-radius: 2px; box-shadow: 0 0 5px var(--glow-color-yellow); }
        .dial-value { font-size: 0.9em; color: var(--glow-color-yellow); }

        /* Blinking Light */
        .blinking-light { width: 18px; height: 18px; border-radius: 50%; background-color: var(--glow-color-yellow); box-shadow: 0 0 8px var(--glow-color-yellow), 0 0 15px var(--glow-color-yellow); transition: background-color 0.3s, box-shadow 0.3s; }
        .blinking-light.red { background-color: var(--glow-color-red); box-shadow: 0 0 10px var(--glow-color-red), 0 0 20px var(--glow-color-red); animation: blink-fast 0.5s infinite step-end; }
        .blinking-light.yellow { background-color: var(--glow-color-yellow); box-shadow: 0 0 8px var(--glow-color-yellow), 0 0 15px var(--glow-color-yellow); animation: blink 1s infinite step-end; }
        .blinking-light.green { background-color: var(--glow-color-green); box-shadow: 0 0 8px var(--glow-color-green); animation: none; }
        .blinking-light.off { background-color: #4b5563; box-shadow: inset 0 1px 3px rgba(0,0,0,0.5); animation: none; }
        @keyframes blink { 50% { background-color: var(--bg-light); box-shadow: inset 0 1px 3px rgba(0,0,0,0.5); } }
        @keyframes blink-fast { 50% { background-color: var(--bg-light); box-shadow: inset 0 1px 3px rgba(0,0,0,0.5); } }

        /* Layout & Panels */
        .main-grid { display: grid; grid-template-columns: 1fr 2.5fr 1.5fr; /* Adjusted right panel width */ grid-template-rows: auto 1fr auto; gap: 20px; height: calc(100% - 70px); flex-grow: 1; }
        .panel { background-color: var(--bg-medium); padding: 15px; border-radius: 8px; border: 1px solid var(--border-color); box-shadow: inset 0 1px 3px rgba(0,0,0,0.5); display: flex; flex-direction: column; gap: 15px; }
        .panel-title { font-size: 1.1em; font-weight: bold; margin-bottom: 10px; padding-bottom: 5px; border-bottom: 1px solid var(--border-color); text-shadow: 0 0 5px currentColor; }
        .header-bar { grid-column: 1 / -1; grid-row: 1 / 2; display: flex; justify-content: space-between; align-items: center; padding-bottom: 15px; border-bottom: 1px solid var(--border-color); margin-bottom: 15px; }
        .footer-bar { grid-column: 1 / -1; grid-row: 3 / 4; padding-top: 15px; border-top: 1px solid var(--border-color); margin-top: 15px; }
        .left-panel { grid-column: 1 / 2; grid-row: 2 / 3; display: flex; flex-direction: column; gap: 20px; }
        .center-panel { grid-column: 2 / 3; grid-row: 2 / 3; display: flex; flex-direction: column; gap: 20px; }
        .right-panel { grid-column: 3 / 4; grid-row: 2 / 3; display: flex; flex-direction: column; gap: 20px; } /* Keep right panel separate */

        /* Utility */
        .text-glow { text-shadow: 0 0 7px currentColor; }
        .text-red-glow { color: var(--glow-color-red); text-shadow: 0 0 8px var(--glow-color-red); }
        .text-yellow-glow { color: var(--glow-color-yellow); text-shadow: 0 0 8px var(--glow-color-yellow); }
        .text-blue-glow { color: var(--glow-color-blue); text-shadow: 0 0 8px var(--glow-color-blue); }
        .text-cyan-glow { color: var(--glow-color-cyan); text-shadow: 0 0 8px var(--glow-color-cyan); }

        /* Alert Box */
        #alert-box { position: fixed; top: -100px; left: 50%; transform: translateX(-50%); background-color: rgba(185, 28, 28, 0.95); color: white; padding: 15px 30px; border-radius: 6px; border: 1px solid #fca5a5; box-shadow: 0 8px 20px rgba(0,0,0,0.6); z-index: 1000; display: block; opacity: 0; font-size: 1.2rem; text-align: center; transition: top 0.5s ease-out, opacity 0.5s ease-out; }
        #alert-box.show { top: 20px; opacity: 1; }

        /* New Visualizations */
        .gauge-container { display: flex; justify-content: space-around; align-items: center; padding: 10px 0; }
        .gauge { width: 100px; height: 50px; border-radius: 50px 50px 0 0; background-color: #ddd; border: 3px solid #555; position: relative; overflow: hidden; box-shadow: inset 0 3px 5px rgba(0,0,0,0.3); }
        .gauge-fill { position: absolute; bottom: 0; left: 0; width: 100%; height: 100%; background: linear-gradient(to top, #ff0000, #ffff00, #00ff00); transform-origin: bottom center; }
        .gauge-needle { position: absolute; bottom: 0; left: 50%; width: 2px; height: 48px; background-color: #333; transform-origin: bottom center; transform: translateX(-50%) rotate(-90deg); transition: transform 0.5s ease-out; box-shadow: 0 0 2px rgba(0,0,0,0.5); }
        .gauge-center { position: absolute; bottom: -3px; left: 50%; transform: translateX(-50%); width: 8px; height: 8px; background-color: #333; border-radius: 50%; z-index: 1; }
        .gauge-label { text-align: center; font-size: 0.8em; margin-top: 2px; }

        .level-indicator { width: 80%; height: 150px; background-color: var(--bg-dark); border: 2px solid var(--border-color); border-radius: 4px; margin: 10px auto; position: relative; overflow: hidden; }
        .level-fill { position: absolute; bottom: 0; left: 0; width: 100%; background-color: var(--glow-color-blue); /* Coolant color */ transition: height 0.5s ease-out; box-shadow: inset 0 0 10px rgba(96, 165, 250, 0.5); } /* blue-400 */
        .level-fill.steam { background-color: #cbd5e1; /* Tailwind slate-300 for steam */ box-shadow: inset 0 0 10px rgba(203, 213, 225, 0.5); }

        .turbine-viz { text-align: center; padding: 15px 0; }
        .turbine-icon { display: inline-block; font-size: 3rem; /* Adjust size */ color: var(--glow-color-cyan); transition: transform 0.2s linear; }
        /* Simple rotating animation - speed controlled by JS */
        @keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
        .turbine-spinning { animation: spin linear infinite; } /* Applied via JS */

        .power-output { text-align: center; font-size: 1.8em; font-weight: bold; color: var(--glow-color-yellow); text-shadow: 0 0 10px var(--glow-color-yellow); padding: 10px 0; }

        /* Responsive */
        @media (max-width: 1200px) {
            .main-grid { grid-template-columns: 1fr 1.5fr; grid-template-rows: auto auto 1fr auto; }
            .left-panel { grid-column: 1 / 2; grid-row: 2 / 3; }
            .center-panel { grid-column: 2 / 3; grid-row: 2 / 3; }
            .right-panel { grid-column: 1 / 3; grid-row: 3 / 4; display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; } /* Grid for right panel items */
            .footer-bar { grid-column: 1 / -1; grid-row: 4 / 5; }
        }
        @media (max-width: 768px) {
            body { padding: 0.5rem; font-size: 0.85rem; }
            .control-panel-bg { height: auto; max-height: 95vh; overflow-y: auto; padding: 15px; }
            .main-grid { grid-template-columns: 1fr; grid-template-rows: auto auto auto auto auto; height: auto; }
            .left-panel { grid-column: 1 / -1; grid-row: 2 / 3; }
            .center-panel { grid-column: 1 / -1; grid-row: 3 / 4; }
            .right-panel { grid-column: 1 / -1; grid-row: 4 / 5; grid-template-columns: 1fr; } /* Stack right panel items */
            .footer-bar { grid-column: 1 / -1; grid-row: 5 / 6; }
            .screen { min-height: 150px; font-size: 0.8rem; }
            .header-bar h1 { font-size: 1.1rem; }
            .control-button { padding: 8px 14px; }
            .dial { width: 80px; height: 80px; }
            .blinking-light { width: 15px; height: 15px; }
            .gauge { width: 80px; height: 40px; }
            .gauge-needle { height: 38px; }
            .level-indicator { height: 120px; }
            .power-output { font-size: 1.5em; }
        }

        /* Shake animation */
        @keyframes shake { /* Same as before */
            0% { transform: translate(1px, 1px) rotate(0deg); } 10% { transform: translate(-1px, -2px) rotate(-1deg); }
            20% { transform: translate(-3px, 0px) rotate(1deg); } 30% { transform: translate(3px, 2px) rotate(0deg); }
            40% { transform: translate(1px, -1px) rotate(1deg); } 50% { transform: translate(-1px, 2px) rotate(-1deg); }
            60% { transform: translate(-3px, 1px) rotate(0deg); } 70% { transform: translate(3px, 1px) rotate(-1deg); }
            80% { transform: translate(-1px, -1px) rotate(1deg); } 90% { transform: translate(1px, 2px) rotate(0deg); }
            100% { transform: translate(1px, -2px) rotate(-1deg); }
        }
        .meltdown-shake { animation: shake 0.5s infinite; }

    </style>
</head>
<body>

    <div id="control-panel" class="control-panel-bg">
        <div class="header-bar">
            <h1 class="text-xl lg:text-2xl font-bold text-glow text-cyan-400">SECTOR 9-X : CORE CONTROL INTERFACE</h1>
            <div class="flex items-center space-x-4">
                <span id="system-time" class="text-sm text-blue-400 text-glow">--:--:--</span>
                <div id="master-warning-light" class="blinking-light off" title="System Status: Offline"></div>
                <button id="audio-toggle" class="control-button text-xs">Enable Audio</button>
            </div>
        </div>

        <div class="main-grid">
            <div class="left-panel">
                <div class="panel">
                    <h2 class="panel-title text-yellow-400">SYSTEM STATUS</h2>
                    <div class="space-y-2 text-sm">
                        <p>Coolant Flow: <span id="coolant-status" class="font-bold text-red-500">OFFLINE</span> (<span id="coolant-flow-rate">0</span>%)</p>
                        <p>Containment Field: <span id="containment-status" class="font-bold text-gray-500">INACTIVE</span></p>
                        <p>Turbine Speed: <span id="turbine-speed" class="font-bold text-gray-500">0 RPM</span></p>
                        <p>Aux Power: <span id="aux-power-status" class="font-bold text-red-500">OFFLINE</span></p>
                        <p>Core Temp: <span id="temp-readout" class="font-bold text-green-400">25.0Â°C</span></p>
                        <p>Core Pressure: <span id="pressure-readout" class="font-bold text-green-400">1.00 ATM</span></p>
                         <p>Power Output: <span id="power-output-status" class="font-bold text-gray-500">0 MW</span></p>
                    </div>
                </div>
                <div class="panel">
                    <h2 class="panel-title text-yellow-400">PRIMARY CONTROLS</h2>
                    <div class="space-y-5">
                        <div class="flex items-center justify-between">
                            <label for="coolant-switch" class="text-sm">Primary Coolant Pump</label>
                            <div id="coolant-switch" class="switch" data-control="coolant">
                                <div class="switch-handle"></div>
                            </div>
                        </div>
                        <div class="flex items-center justify-between">
                            <label for="aux-power-switch" class="text-sm">Auxiliary Power Grid</label>
                            <div id="aux-power-switch" class="switch" data-control="aux-power">
                                <div class="switch-handle"></div>
                            </div>
                        </div>
                         <div class="flex items-center justify-between">
                            <label for="venting-switch" class="text-sm">Emergency Venting</label>
                            <div id="venting-switch" class="switch" data-control="venting">
                                <div class="switch-handle"></div>
                            </div>
                        </div>
                        <button id="reset-alerts-btn" class="control-button w-full mt-4">Reset Alerts</button>
                    </div>
                </div>
                 <div class="panel">
                     <h2 class="panel-title text-yellow-400">COOLANT CONTROL</h2>
                     <div class="dial-container">
                         <div id="coolant-dial" class="dial">
                             <div class="dial-indicator"></div>
                         </div>
                         <span class="dial-value"><span id="coolant-dial-value">0</span>% Flow</span>
                     </div>
                 </div>
            </div>

            <div class="center-panel">
                 <div class="panel flex-grow flex flex-col">
                    <h2 class="panel-title text-blue-400">SYSTEM LOG / COMMAND INPUT</h2>
                    <div id="log-screen" class="screen scanlines flex-grow mb-3 relative">
                        </div>
                     <input type="text" id="command-input" class="w-full p-2 bg-black border border-cyan-700 text-cyan-400 rounded focus:outline-none focus:ring-2 focus:ring-cyan-500 placeholder-gray-600 text-sm" placeholder="Enter command... (try 'help')">
                 </div>
                 <div class="panel text-center">
                     <h2 class="panel-title text-red-500">REACTOR CORE CONTROL</h2>
                     <button id="initiate-reactor-btn" class="control-button button-glow-red text-lg px-8 py-3">INITIATE REACTOR</button>
                     <p id="reactor-status-msg" class="mt-3 text-yellow-400 text-md font-bold">STATUS: OFFLINE</p>
                 </div>
            </div>

            <div class="right-panel">
                 <div class="panel">
                     <h2 class="panel-title text-cyan-400">TURBINE STATUS</h2>
                     <div class="turbine-viz">
                         <svg id="turbine-icon" class="turbine-icon w-16 h-16 mx-auto" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                             <path d="M12 2C10.3 2 8.79 2.55 7.67 3.55L12 10.88V2zM4.04 5.85C2.79 7.34 2 9.08 2 11H8.03L4.04 5.85zM16.33 3.55C15.21 2.55 13.7 2 12 2V10.88L16.33 3.55zM19.96 5.85L15.97 11H22C22 9.08 21.