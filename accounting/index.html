<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Personal Accounting</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        /* Apply Inter font globally */
        body {
            font-family: 'Inter', sans-serif;
        }
        /* Custom scrollbar for better aesthetics (optional) */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }
        ::-webkit-scrollbar-thumb {
            background: #cbd5e1; /* slate-300 */
            border-radius: 10px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #94a3b8; /* slate-400 */
        }
        /* Style for the savings needed display */
        .savings-highlight {
            background-color: #fef9c3; /* yellow-100 */
            border: 1px solid #fde047; /* yellow-300 */
            color: #ca8a04; /* yellow-600 */
        }
        /* Ensure forms take full width within their containers */
        form {
            width: 100%;
        }
        /* Consistent button styling */
        button {
            transition: background-color 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
        }
        button:hover {
             box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
        }
        /* Add some spacing below list items */
        li {
            margin-bottom: 0.5rem; /* Equivalent to mb-2 */
        }
         /* Style for delete buttons */
        .delete-button {
             padding: 2px 6px;
             border-radius: 4px;
             font-size: 0.75rem; /* text-xs */
             font-weight: 500; /* font-medium */
             margin-left: 0.5rem; /* ml-2 */
             background-color: #fee2e2; /* red-100 */
             color: #dc2626; /* red-600 */
             border: 1px solid #fecaca; /* red-200 */
        }
        .delete-button:hover {
             background-color: #fecaca; /* red-200 */
             color: #b91c1c; /* red-700 */
             box-shadow: none; /* Override general button hover shadow */
        }
    </style>
</head>
<body class="bg-slate-100 text-slate-800 min-h-screen p-4 md:p-8">
    <div class="max-w-6xl mx-auto">
        <h1 class="text-3xl font-bold text-center mb-8 text-slate-700">Personal Accounting Dashboard</h1>

        <div id="savings-section" class="mb-8 p-6 bg-white rounded-lg shadow-md text-center">
            <h2 class="text-xl font-semibold mb-3 text-slate-600">Savings Target for Next Pay Period</h2>
            <p id="savings-needed" class="text-3xl font-bold savings-highlight p-4 rounded-md inline-block">Calculating...</p>
            <p id="pay-period-info" class="text-sm text-slate-500 mt-2"></p>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">

            <div class="bg-white p-6 rounded-lg shadow-md">
                <h2 class="text-xl font-semibold mb-4 text-slate-600">Weekly Income</h2>
                <form id="income-form" class="space-y-4">
                    <div>
                        <label for="weekly-income" class="block text-sm font-medium text-slate-700 mb-1">Enter Weekly Income Amount:</label>
                        <input type="number" id="weekly-income" step="0.01" required class="w-full px-3 py-2 border border-slate-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                    </div>
                    <div>
                        <label for="payday" class="block text-sm font-medium text-slate-700 mb-1">Select Payday:</label>
                        <select id="payday" required class="w-full px-3 py-2 border border-slate-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 bg-white">
                            <option value="0">Sunday</option>
                            <option value="1">Monday</option>
                            <option value="2">Tuesday</option>
                            <option value="3">Wednesday</option>
                            <option value="4">Thursday</option>
                            <option value="5">Friday</option>
                            <option value="6">Saturday</option>
                        </select>
                    </div>
                    <button type="submit" class="w-full bg-indigo-600 text-white py-2 px-4 rounded-md hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 font-medium">Set Income & Payday</button>
                </form>
                <div class="mt-4 text-center">
                     <p class="text-lg">Current Weekly Income: <strong id="display-income" class="text-indigo-700">$0.00</strong></p>
                     <p class="text-sm text-slate-500">Payday: <strong id="display-payday">Not Set</strong></p>
                </div>
            </div>

            <div class="bg-white p-6 rounded-lg shadow-md">
                <h2 class="text-xl font-semibold mb-4 text-slate-600">Add One-Time Expense</h2>
                <form id="expense-form" class="space-y-4">
                    <div>
                        <label for="expense-desc" class="block text-sm font-medium text-slate-700 mb-1">Description:</label>
                        <input type="text" id="expense-desc" required class="w-full px-3 py-2 border border-slate-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                    </div>
                    <div>
                        <label for="expense-amount" class="block text-sm font-medium text-slate-700 mb-1">Amount:</label>
                        <input type="number" id="expense-amount" step="0.01" required class="w-full px-3 py-2 border border-slate-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                    </div>
                     <div>
                        <label for="expense-date" class="block text-sm font-medium text-slate-700 mb-1">Date:</label>
                        <input type="date" id="expense-date" required class="w-full px-3 py-2 border border-slate-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                    </div>
                    <button type="submit" class="w-full bg-emerald-600 text-white py-2 px-4 rounded-md hover:bg-emerald-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-emerald-500 font-medium">Add Expense</button>
                </form>
            </div>

            <div class="bg-white p-6 rounded-lg shadow-md">
                <h2 class="text-xl font-semibold mb-4 text-slate-600">Add Recurring Charge (Bill)</h2>
                <form id="recurring-form" class="space-y-4">
                    <div>
                        <label for="recurring-desc" class="block text-sm font-medium text-slate-700 mb-1">Description:</label>
                        <input type="text" id="recurring-desc" required class="w-full px-3 py-2 border border-slate-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                    </div>
                    <div>
                        <label for="recurring-amount" class="block text-sm font-medium text-slate-700 mb-1">Amount:</label>
                        <input type="number" id="recurring-amount" step="0.01" required class="w-full px-3 py-2 border border-slate-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                    </div>
                    <div>
                        <label for="recurring-day" class="block text-sm font-medium text-slate-700 mb-1">Day of Month Due (1-31):</label>
                        <input type="number" id="recurring-day" min="1" max="31" required class="w-full px-3 py-2 border border-slate-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500">
                    </div>
                    <button type="submit" class="w-full bg-sky-600 text-white py-2 px-4 rounded-md hover:bg-sky-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-sky-500 font-medium">Add Recurring Charge</button>
                </form>
            </div>

            <div class="bg-white p-6 rounded-lg shadow-md lg:col-span-1">
                 <h2 class="text-xl font-semibold mb-4 text-slate-600">Recent Expenses</h2>
                 <ul id="expense-list" class="space-y-2 max-h-60 overflow-y-auto text-sm">
                     <li class="text-slate-500 italic">No expenses added yet.</li>
                 </ul>
            </div>

            <div class="bg-white p-6 rounded-lg shadow-md lg:col-span-2">
                 <h2 class="text-xl font-semibold mb-4 text-slate-600">Recurring Charges (Monthly Bills)</h2>
                 <ul id="recurring-list" class="space-y-2 max-h-60 overflow-y-auto text-sm">
                     <li class="text-slate-500 italic">No recurring charges added yet.</li>
                 </ul>
             </div>

        </div>
    </div>

    <script>
        // --- DOM Elements ---
        const incomeForm = document.getElementById('income-form');
        const weeklyIncomeInput = document.getElementById('weekly-income');
        const paydaySelect = document.getElementById('payday');
        const displayIncome = document.getElementById('display-income');
        const displayPayday = document.getElementById('display-payday');

        const expenseForm = document.getElementById('expense-form');
        const expenseDescInput = document.getElementById('expense-desc');
        const expenseAmountInput = document.getElementById('expense-amount');
        const expenseDateInput = document.getElementById('expense-date');
        const expenseList = document.getElementById('expense-list');

        const recurringForm = document.getElementById('recurring-form');
        const recurringDescInput = document.getElementById('recurring-desc');
        const recurringAmountInput = document.getElementById('recurring-amount');
        const recurringDayInput = document.getElementById('recurring-day');
        const recurringList = document.getElementById('recurring-list');

        const savingsNeededDisplay = document.getElementById('savings-needed');
        const payPeriodInfoDisplay = document.getElementById('pay-period-info');

        // --- Data Storage ---
        let data = {
            weeklyIncome: null,
            paydayOfWeek: null,
            expenses: [],
            recurringCharges: []
        };

        // --- Utility Functions ---
        function formatCurrency(amount) {
            if (amount === null || isNaN(amount)) {
                return '$0.00';
            }
            return amount.toLocaleString('en-US', { style: 'currency', currency: 'USD' });
        }

        function getDayName(dayIndex) {
             const days = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];
             // Handle null or undefined dayIndex
             return days[parseInt(dayIndex, 10)] ?? 'Not Set';
        }

        function saveData() {
            try {
                localStorage.setItem('personalAccountingData', JSON.stringify(data));
                console.log("Data saved:", data); // Log saved data
            } catch (e) {
                console.error("Error saving data to localStorage:", e);
                alert("Could not save data. LocalStorage might be full or disabled.");
            }
        }

        function loadData() {
            const savedData = localStorage.getItem('personalAccountingData');
            console.log("Raw loaded data:", savedData); // Log raw data
            if (savedData) {
                try {
                    data = JSON.parse(savedData);
                    // Ensure nested arrays exist and dates are Date objects if needed (though storing as strings is fine here)
                    data.expenses = data.expenses || [];
                    data.recurringCharges = data.recurringCharges || [];
                     // Convert date strings back to Date objects if necessary for sorting/filtering
                     // data.expenses = data.expenses.map(exp => ({...exp, date: new Date(exp.date)}));
                    console.log("Parsed loaded data:", data); // Log parsed data
                } catch (e) {
                    console.error("Error parsing data from localStorage:", e);
                    data = { weeklyIncome: null, paydayOfWeek: null, expenses: [], recurringCharges: [] };
                }
            } else {
                 console.log("No saved data found, initializing defaults.");
            }
            // Set default date for expense input if empty
            if (!expenseDateInput.value) {
                expenseDateInput.valueAsDate = new Date();
            }
        }

        // --- Rendering Functions ---
        function renderIncome() {
            console.log("Rendering income:", data.weeklyIncome, data.paydayOfWeek); // Log before rendering
            displayIncome.textContent = formatCurrency(data.weeklyIncome);
            displayPayday.textContent = getDayName(data.paydayOfWeek);
            if (data.weeklyIncome !== null) {
                weeklyIncomeInput.value = data.weeklyIncome;
            } else {
                weeklyIncomeInput.value = ''; // Clear if null
            }
            if (data.paydayOfWeek !== null) {
                paydaySelect.value = data.paydayOfWeek;
            } else {
                 paydaySelect.selectedIndex = -1; // Clear selection if null
            }
        }

        function renderExpenses() {
            console.log("Rendering expenses. Count:", data.expenses.length); // Log before rendering
            expenseList.innerHTML = ''; // Clear existing list
            if (data.expenses.length === 0) {
                expenseList.innerHTML = '<li class="text-slate-500 italic">No expenses added yet.</li>';
                return;
            }
            // Sort expenses by date, most recent first
            const sortedExpenses = [...data.expenses].sort((a, b) => new Date(b.date) - new Date(a.date));

            sortedExpenses.forEach((expense) => { // Removed index, using ID now
                const li = document.createElement('li');
                li.className = 'flex justify-between items-center p-2 rounded hover:bg-slate-50';
                // Use data-id attribute to store the unique ID
                li.innerHTML = `
                    <span>
                        <span class="font-medium">${expense.desc}</span> - ${formatCurrency(expense.amount)}
                        <span class="text-xs text-slate-500 ml-1">(${new Date(expense.date).toLocaleDateString()})</span>
                    </span>
                    <button data-id="${expense.id}" class="delete-expense delete-button">Delete</button>
                `;
                expenseList.appendChild(li);
            });

             // Add event listeners to delete buttons *after* adding all list items
             expenseList.querySelectorAll('.delete-expense').forEach(button => {
                 // Remove existing listener before adding a new one to prevent duplicates if re-rendering often
                 button.removeEventListener('click', handleDeleteExpense);
                 button.addEventListener('click', handleDeleteExpense);
             });
        }


        function renderRecurringCharges() {
            console.log("Rendering recurring charges. Count:", data.recurringCharges.length); // Log before rendering
            recurringList.innerHTML = ''; // Clear existing list
            if (data.recurringCharges.length === 0) {
                recurringList.innerHTML = '<li class="text-slate-500 italic">No recurring charges added yet.</li>';
                return;
            }
             const sortedCharges = [...data.recurringCharges].sort((a, b) => a.dayDue - b.dayDue);

            sortedCharges.forEach((charge) => { // Removed index, using ID now
                const li = document.createElement('li');
                li.className = 'flex justify-between items-center p-2 rounded hover:bg-slate-50';
                 // Use data-id attribute to store the unique ID
                li.innerHTML = `
                    <span>
                        <span class="font-medium">${charge.desc}</span> - ${formatCurrency(charge.amount)}
                        <span class="text-xs text-slate-500 ml-1">(Due day: ${charge.dayDue})</span>
                    </span>
                     <button data-id="${charge.id}" class="delete-recurring delete-button">Delete</button>
                `;
                recurringList.appendChild(li);
            });

             // Add event listeners to delete buttons *after* adding all list items
             recurringList.querySelectorAll('.delete-recurring').forEach(button => {
                 // Remove existing listener before adding a new one
                 button.removeEventListener('click', handleDeleteRecurring);
                 button.addEventListener('click', handleDeleteRecurring);
             });
        }

        // --- Event Handlers ---
        function handleIncomeSubmit(event) {
            event.preventDefault();
            console.log("Income form submitted."); // Log submission
            const incomeValue = parseFloat(weeklyIncomeInput.value);
            const paydayValue = parseInt(paydaySelect.value, 10);

            if (isNaN(incomeValue) || incomeValue < 0) {
                alert("Please enter a valid positive income amount.");
                return;
            }
             if (isNaN(paydayValue) || paydayValue < 0 || paydayValue > 6) {
                 alert("Please select a valid payday.");
                 return;
             }

            data.weeklyIncome = incomeValue;
            data.paydayOfWeek = paydayValue;
            console.log("Income data updated:", data.weeklyIncome, data.paydayOfWeek); // Log updated data
            saveData();
            renderIncome();
            calculateAndDisplaySavings();
        }

        function handleExpenseSubmit(event) {
            event.preventDefault();
            console.log("Expense form submitted."); // Log submission
            const desc = expenseDescInput.value.trim();
            const amount = parseFloat(expenseAmountInput.value);
            const date = expenseDateInput.value; // YYYY-MM-DD string

            if (!desc || isNaN(amount) || amount <= 0 || !date) {
                alert("Please fill in all expense fields with valid values.");
                return;
            }

            const newExpense = {
                id: Date.now().toString() + Math.random().toString(36).substring(2, 9), // More unique ID
                desc,
                amount,
                date
            };
            data.expenses.push(newExpense);
            console.log("Expense added to data:", newExpense); // Log added expense
            saveData();
            renderExpenses(); // Re-render the list
            // calculateAndDisplaySavings(); // Not needed for one-time expenses

            expenseForm.reset();
            expenseDateInput.valueAsDate = new Date(); // Reset date to today
        }

        function handleRecurringSubmit(event) {
            event.preventDefault();
            console.log("Recurring charge form submitted."); // Log submission
            const desc = recurringDescInput.value.trim();
            const amount = parseFloat(recurringAmountInput.value);