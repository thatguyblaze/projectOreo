<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tow Ticket - Treadz</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="../../css/style.css">

    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-image: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
        }

        .glass-panel {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.15);
        }

        .ticket-page {
            width: 100%;
            max-width: 500px;
            /* Slightly wider for modern look */
            margin: 0 auto;
            position: relative;
        }

        .form-input {
            width: 100%;
            background: rgba(243, 244, 246, 0.6);
            border: 1px solid #e5e7eb;
            border-radius: 0.5rem;
            padding: 0.5rem 0.75rem;
            font-size: 0.875rem;
            transition: all 0.2s;
        }

        .form-input:focus {
            outline: none;
            background: white;
            border-color: #2563eb;
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }

        .form-label {
            display: block;
            font-size: 0.75rem;
            font-weight: 600;
            color: #4b5563;
            margin-bottom: 0.25rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .toggle-btn {
            width: 100%;
            padding: 0.5rem;
            font-size: 0.75rem;
            font-weight: 600;
            border-radius: 0.5rem;
            border: 1px solid #e5e7eb;
            background: white;
            color: #4b5563;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.25rem;
        }

        .toggle-btn:hover {
            background: #f9fafb;
            border-color: #d1d5db;
        }

        .toggle-btn.active {
            background: #2563eb;
            color: white;
            border-color: #2563eb;
            box-shadow: 0 4px 6px -1px rgba(37, 99, 235, 0.2);
        }

        .section-title {
            font-size: 0.875rem;
            font-weight: 700;
            color: #111827;
            padding-bottom: 0.5rem;
            margin-bottom: 1rem;
            border-bottom: 1px solid #e5e7eb;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        @media print {
            @page {
                size: 4.5in auto;
                margin: 0;
            }

            body {
                background: white !important;
                -webkit-print-color-adjust: exact !important;
                print-color-adjust: exact !important;
            }

            .ticket-page {
                box-shadow: none !important;
                border: none !important;
                max-width: 100% !important;
                margin: 0 !important;
                background: white !important;
            }

            .glass-panel {
                box-shadow: none !important;
                border: none !important;
                background: white !important;
            }

            .print\:hidden {
                display: none !important;
            }

            .form-input {
                background: transparent !important;
                border: none !important;
                padding: 0 !important;
                margin: 0 !important;
                font-weight: 600;
                color: black !important;
                resize: none !important;
                height: auto !important;
            }

            /* Hide inactive toggle buttons completely */
            .toggle-btn {
                display: none !important;
            }

            /* Show active toggle buttons as plain text */
            .toggle-btn.active {
                display: block !important;
                background: transparent !important;
                color: black !important;
                border: none !important;
                box-shadow: none !important;
                padding: 0 !important;
                font-weight: bold !important;
                text-align: left !important;
            }

            /* Adjust grid gaps since items are hidden */
            .grid {
                display: block !important;
            }

            .grid>* {
                margin-bottom: 4px;
            }

            .section-title {
                border-bottom: 2px solid #000;
                margin-top: 10px;
                margin-bottom: 5px;
            }

            .no-print-bg {
                background: none !important;
                border: none !important;
                padding: 0 !important;
            }
        }
    </style>
</head>

<body class="antialiased flex flex-col min-h-screen">
    <!-- Navigation -->
    <nav class="main-nav sticky top-0 z-40 p-4 w-full print:hidden flex-shrink-0">
        <div class="max-w-7xl mx-auto flex items-center justify-between">
            <!-- LEFT: Logo & Global Navigation -->
            <div class="flex items-center gap-8">
                <a href="../../index.html" class="flex-shrink-0">
                    <img src="../../treadztntLogo.png" alt="Treadz" class="h-10 w-auto">
                </a>

                <!-- Vertical Divider -->
                <div class="hidden md:block h-6 w-px bg-white/20"></div>

                <!-- Global Nav Items -->
                <div class="hidden md:flex items-center gap-1">
                    <a href="../../index.html"
                        class="btn btn-secondary text-gray-300 hover:text-white hover:bg-white/10 font-medium py-2 px-4 rounded-lg transition-all">Inventory</a>
                    <a href="../index.html"
                        class="btn btn-secondary active font-semibold py-2 px-4 rounded-lg">Towing</a>
                    <a href="../../quote/index.html"
                        class="btn btn-secondary text-gray-300 hover:text-white hover:bg-white/10 font-medium py-2 px-4 rounded-lg transition-all">Quote</a>
                    <a href="../../receipt/index.html"
                        class="btn btn-secondary text-gray-300 hover:text-white hover:bg-white/10 font-medium py-2 px-4 rounded-lg transition-all">Receipts</a>
                </div>
            </div>

            <!-- RIGHT: Actions -->
            <div class="flex items-center gap-2">
                <a href="../index.html" class="btn btn-secondary text-sm font-medium py-2 px-3 flex items-center gap-2">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M19 12H5M12 19l-7-7 7-7" />
                    </svg>
                    Back to Calculator
                </a>
                <button onclick="printTowTicket()"
                    class="btn bg-gray-800 hover:bg-black text-white py-2 px-4 rounded-lg flex items-center gap-2 shadow-lg">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <polyline points="6 9 6 2 18 2 18 9"></polyline>
                        <path d="M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2"></path>
                        <rect x="6" y="14" width="12" height="8"></rect>
                    </svg>
                    <span class="hidden sm:inline">Print</span>
                </button>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="flex-grow flex justify-center p-4 pb-24 overflow-y-auto print:overflow-visible">

        <!-- TICKET PAPER -->
        <div id="ticket-body" class="ticket-page glass-panel rounded-2xl p-6 md:p-8 animate-[fadeIn_0.5s_ease-out]">

            <!-- TICKET HEADER -->
            <div class="text-center mb-6 pb-4 border-b-2 border-gray-900 relative">
                <div class="flex justify-center mb-3">
                    <img src="../../treadztntLogo.png" alt="Treadz" class="h-14 w-auto grayscale contrast-125">
                </div>
                <div class="text-xs font-serif leading-tight text-gray-800">
                    <div class="font-bold text-sm tracking-wide">TIRE & TOWING</div>
                    <div>409 Main Street E.</div>
                    <div>Mt. Carmel, TN 37645</div>
                    <div class="font-bold mt-1 text-sm">423-357-4551</div>
                </div>
                <div class="absolute top-2 left-0 text-xl font-bold font-serif text-red-600 param-ticket-id">
                    <!-- ID injected via JS -->
                </div>
                <div class="absolute top-2 right-0 flex flex-col items-end">
                    <span class="text-[10px] text-gray-500 font-bold uppercase tracking-wider">Date</span>
                    <input type="text" id="tt-date"
                        class="text-right text-xs font-bold bg-transparent border-none w-24 p-0">
                </div>
            </div>

            <!-- 1. CUSTOMER INFO -->
            <div class="mb-6">
                <div class="section-title">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                        class="text-blue-600">
                        <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                        <circle cx="12" cy="7" r="4"></circle>
                    </svg>
                    CUSTOMER DETIALS
                </div>
                <div class="grid grid-cols-1 gap-3">
                    <div>
                        <label class="form-label">Bill To</label>
                        <input type="text" id="tt-bill-to" class="form-input">
                    </div>
                    <div class="grid grid-cols-2 gap-3">
                        <div class="col-span-2">
                            <label class="form-label">Address</label>
                            <div class="relative">
                                <input type="text" id="tt-address" class="form-input"
                                    placeholder="Start typing address..." autocomplete="off">
                                <ul id="address-suggestions"
                                    class="absolute left-0 w-full bg-white border border-gray-300 rounded-lg shadow-lg z-50 hidden max-h-60 overflow-y-auto top-full mt-1">
                                </ul>
                            </div>
                        </div>
                    </div>
                    <div>
                        <label class="form-label">Phone Number</label>
                        <input type="text" id="tt-phone" class="form-input">
                    </div>
                </div>
            </div>

            <!-- 2. VEHICLE INFO -->
            <div class="mb-6">
                <div class="section-title">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                        class="text-blue-600">
                        <rect x="1" y="3" width="15" height="13"></rect>
                        <polygon points="16 8 20 8 23 11 23 16 16 16 16 8"></polygon>
                        <circle cx="5.5" cy="18.5" r="2.5"></circle>
                        <circle cx="18.5" cy="18.5" r="2.5"></circle>
                    </svg>
                    VEHICLE INFORMATION
                </div>
                <div class="grid grid-cols-2 gap-3">
                    <div class="col-span-2">
                        <label class="form-label">Pickup Location</label>
                        <div class="relative">
                            <input type="text" id="tt-location" class="form-input"
                                placeholder="Start typing location..." autocomplete="off">
                            <ul id="location-suggestions"
                                class="absolute left-0 w-full bg-white border border-gray-300 rounded-lg shadow-lg z-50 hidden max-h-60 overflow-y-auto top-full mt-1">
                            </ul>
                        </div>
                    </div>
                    <div class="col-span-2 grid grid-cols-2 gap-2">
                        <div>
                            <label class="form-label">Make</label>
                            <select id="tt-make" class="form-input appearance-none" onchange="updateMakeModel()">
                                <option value="">Select Make</option>
                                <option value="Acura">Acura</option>
                                <option value="Audi">Audi</option>
                                <option value="BMW">BMW</option>
                                <option value="Buick">Buick</option>
                                <option value="Cadillac">Cadillac</option>
                                <option value="Chevrolet">Chevrolet</option>
                                <option value="Chrysler">Chrysler</option>
                                <option value="Dodge">Dodge</option>
                                <option value="Ford">Ford</option>
                                <option value="GMC">GMC</option>
                                <option value="Honda">Honda</option>
                                <option value="Hyundai">Hyundai</option>
                                <option value="Infiniti">Infiniti</option>
                                <option value="Jeep">Jeep</option>
                                <option value="Kia">Kia</option>
                                <option value="Lexus">Lexus</option>
                                <option value="Lincoln">Lincoln</option>
                                <option value="Mazda">Mazda</option>
                                <option value="Mercedes-Benz">Mercedes-Benz</option>
                                <option value="Mercury">Mercury</option>
                                <option value="Mini">Mini</option>
                                <option value="Mitsubishi">Mitsubishi</option>
                                <option value="Nissan">Nissan</option>
                                <option value="Pontiac">Pontiac</option>
                                <option value="Ram">Ram</option>
                                <option value="Subaru">Subaru</option>
                                <option value="Tesla">Tesla</option>
                                <option value="Toyota">Toyota</option>
                                <option value="Volkswagen">Volkswagen</option>
                                <option value="Volvo">Volvo</option>
                                <option value="Other">Other</option>
                            </select>
                        </div>
                        <div>
                            <label class="form-label">Model</label>
                            <input type="text" id="tt-model" class="form-input" placeholder="Model"
                                oninput="updateMakeModel()">
                        </div>
                        <input type="hidden" id="tt-make-model">
                    </div>
                    <div>
                        <label class="form-label">Tag Number</label>
                        <input type="text" id="tt-tag" class="form-input">
                    </div>
                    <div>
                        <label class="form-label">Color</label>
                        <select id="tt-color" class="form-input appearance-none">
                            <option value="">Select...</option>
                            <option value="Black">Black</option>
                            <option value="White">White</option>
                            <option value="Silver">Silver</option>
                            <option value="Gray">Gray</option>
                            <option value="Red">Red</option>
                            <option value="Blue">Blue</option>
                            <option value="Brown">Brown</option>
                            <option value="Green">Green</option>
                            <option value="Beige">Beige</option>
                            <option value="Gold">Gold</option>
                            <option value="Orange">Orange</option>
                            <option value="Yellow">Yellow</option>
                            <option value="Purple">Purple</option>
                            <option value="Other">Other</option>
                        </select>
                    </div>
                    <div>
                        <label class="form-label">Mileage</label>
                        <input type="number" id="tt-mileage" class="form-input">
                    </div>
                    <div>
                        <label class="form-label">VIN #</label>
                        <input type="text" id="tt-vin" class="form-input font-mono tracking-wider text-xs">
                    </div>
                </div>
            </div>

            <!-- 3. DAMAGE & AGENCY -->
            <div class="mb-6 bg-gray-50/50 p-4 rounded-xl border border-gray-100 no-print-bg">
                <!-- Agency Toggles -->
                <div class="mb-4">
                    <label class="form-label mb-2">AGENCY / POLICE</label>
                    <div class="grid grid-cols-4 gap-2">
                        <button class="toggle-btn" onclick="toggleBtn(this)" data-group="agency"
                            data-value="Hawkins">Hawkins</button>
                        <button class="toggle-btn" onclick="toggleBtn(this)" data-group="agency"
                            data-value="KPD">KPD</button>
                        <button class="toggle-btn" onclick="toggleBtn(this)" data-group="agency"
                            data-value="THP">THP</button>
                        <button class="toggle-btn" onclick="toggleBtn(this)" data-group="agency"
                            data-value="Other">Other</button>
                    </div>
                    <input type="text" id="other-agency-input" class="form-input mt-2 hidden"
                        placeholder="Specify Agency...">
                </div>

                <!-- Damage Toggles -->
                <div>
                    <label class="form-label mb-2">VEHICLE DAMAGE</label>
                    <div class="grid grid-cols-2 gap-2 mb-2">
                        <button class="toggle-btn" onclick="toggleBtn(this)" data-value="FRT">Front (FRT)</button>
                        <button class="toggle-btn" onclick="toggleBtn(this)" data-value="REAR">Rear</button>
                    </div>
                    <div class="grid grid-cols-4 gap-2">
                        <button class="toggle-btn" onclick="toggleBtn(this)" data-value="LF">LF</button>
                        <button class="toggle-btn" onclick="toggleBtn(this)" data-value="RF">RF</button>
                        <button class="toggle-btn" onclick="toggleBtn(this)" data-value="RR">RR</button>
                        <button class="toggle-btn" onclick="toggleBtn(this)" data-value="LR">LR</button>
                    </div>
                </div>
            </div>

            <!-- 4. FEES & CHARGES -->
            <div class="mb-6">
                <div class="section-title">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                        class="text-blue-600">
                        <line x1="12" y1="1" x2="12" y2="23"></line>
                        <path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"></path>
                    </svg>
                    FEES & CHARGES
                </div>

                <div class="space-y-2 text-sm">
                    <div class="flex items-center justify-between">
                        <span class="text-gray-600">Base Tow</span>
                        <input type="number" id="tt-fee-base"
                            class="text-right font-bold w-24 bg-transparent border-b border-gray-300 focus:outline-none focus:border-blue-500"
                            onchange="calcTicketTotal()">
                    </div>
                    <div class="flex items-center justify-between">
                        <span class="text-gray-600">Winch Fees</span>
                        <input type="number" id="tt-fee-winch"
                            class="text-right font-bold w-24 bg-transparent border-b border-gray-300 focus:outline-none focus:border-blue-500"
                            onchange="calcTicketTotal()">
                    </div>
                    <div class="flex items-center justify-between">
                        <span class="text-gray-600">Clean-Up</span>
                        <input type="number" id="tt-fee-clean"
                            class="text-right font-bold w-24 bg-transparent border-b border-gray-300 focus:outline-none focus:border-blue-500"
                            onchange="calcTicketTotal()">
                    </div>
                    <div class="flex items-center justify-between">
                        <span class="text-gray-600">VTS/ Admin Fee</span>
                        <input type="number" id="tt-fee-admin"
                            class="text-right font-bold w-24 bg-transparent border-b border-gray-300 focus:outline-none focus:border-blue-500"
                            onchange="calcTicketTotal()">
                    </div>
                    <div class="flex items-center justify-between">
                        <span class="text-gray-600">Additional Labor</span>
                        <input type="number" id="tt-fee-labor"
                            class="text-right font-bold w-24 bg-transparent border-b border-gray-300 focus:outline-none focus:border-blue-500"
                            onchange="calcTicketTotal()">
                    </div>
                    <div class="flex items-center justify-between">
                        <span class="text-gray-600">Mileage Charges</span>
                        <input type="number" id="tt-fee-mileage"
                            class="text-right font-bold w-24 bg-transparent border-b border-gray-300 focus:outline-none focus:border-blue-500"
                            onchange="calcTicketTotal()">
                    </div>
                    <div class="flex items-center justify-between">
                        <span class="text-gray-600">Gate Fee(s)</span>
                        <input type="number" id="tt-fee-gate"
                            class="text-right font-bold w-24 bg-transparent border-b border-gray-300 focus:outline-none focus:border-blue-500"
                            onchange="calcTicketTotal()">
                    </div>
                    <div class="flex items-center justify-between">
                        <span class="text-gray-600">Misc. Fees</span>
                        <input type="number" id="tt-fee-misc"
                            class="text-right font-bold w-24 bg-transparent border-b border-gray-300 focus:outline-none focus:border-blue-500"
                            onchange="calcTicketTotal()">
                    </div>
                </div>

                <!-- Storage Calc -->
                <div class="mt-4 p-3 bg-blue-50 border border-blue-100 rounded-lg no-print-bg">
                    <div class="flex justify-between items-center mb-2">
                        <span class="text-xs font-bold text-blue-800 uppercase">Storage Calculator</span>
                    </div>
                    <div class="flex justify-between items-center text-sm">
                        <div class="flex gap-2">
                            <label class="flex items-center gap-1 cursor-pointer"><input type="radio" name="store-rate"
                                    value="35" onchange="calcTicketTotal()" class="accent-blue-600"> $35</label>
                            <label class="flex items-center gap-1 cursor-pointer"><input type="radio" name="store-rate"
                                    value="40" onchange="calcTicketTotal()" class="accent-blue-600"> $40</label>
                            <label class="flex items-center gap-1 cursor-pointer"><input type="radio" name="store-rate"
                                    value="45" onchange="calcTicketTotal()" class="accent-blue-600" checked> $45</label>
                        </div>
                    </div>

                    <!-- Date Selection for Storage -->
                    <div class="mt-3 grid grid-cols-2 gap-3 mb-2">
                        <div>
                            <label class="text-[10px] uppercase font-bold text-gray-500">In Date/Time</label>
                            <input type="datetime-local" id="tt-store-start" class="form-input text-xs p-1"
                                onchange="updateStorageDays()">
                        </div>
                        <div>
                            <label class="text-[10px] uppercase font-bold text-gray-500">Released Date/Time</label>
                            <input type="datetime-local" id="tt-store-end" class="form-input text-xs p-1"
                                onchange="updateStorageDays()">
                        </div>
                    </div>

                    <div class="flex justify-end items-center gap-2">
                        <span class="text-sm font-bold text-gray-700">Billable Days:</span>
                        <div class="flex items-center gap-1">
                            <input type="number" id="tt-store-days"
                                class="w-16 text-center font-bold bg-white border border-gray-300 rounded p-1"
                                onchange="calcTicketTotal()" placeholder="0">
                        </div>
                    </div>
                </div>

                <!-- TOTALS -->
                <div class="mt-6 pt-4 border-t-2 border-gray-200">
                    <div class="flex justify-between items-end mb-2">
                        <span class="text-sm font-medium text-gray-500">Tow Total</span>
                        <span id="display-tow-total" class="font-bold text-gray-800">$0.00</span>
                    </div>
                    <div class="flex justify-between items-end mb-1">
                        <span class="text-sm font-medium text-gray-500">Storage Total</span>
                        <span id="display-store-subtotal" class="font-bold text-gray-800">$0.00</span>
                    </div>
                    <div class="flex justify-between items-end mb-2">
                        <span class="text-xs font-medium text-gray-400">Storage Tax (3.5%)</span>
                        <span id="display-store-tax" class="font-bold text-gray-600">$0.00</span>
                        <input type="hidden" id="tt-total-storage">
                    </div>
                    <div class="flex justify-between items-end mt-4 pt-4 border-t border-gray-200">
                        <span class="text-lg font-black text-gray-900">TOTAL DUE</span>
                        <input type="text" id="tt-total-due"
                            class="text-right font-black text-2xl bg-transparent border-none text-blue-600 w-40"
                            readonly>
                    </div>
                </div>
            </div>

            <!-- 5. FOOTER & NOTES -->
            <div>
                <label class="form-label">Notes</label>
                <textarea id="tt-notes" class="form-input h-20 resize-none mb-4"></textarea>

                <p class="text-[10px] text-gray-500 leading-tight text-justify mb-6">
                    I have removed all personal belongings from my vehicle and hold No one responsible for lost or
                    stolen items. Towing Company is not Responsible for any damages incurred while towing and/or
                    winching vehicle.
                </p>

                <!-- Signatures -->
                <div class="grid grid-cols-1 gap-6">
                    <div class="border-b border-black pt-8">
                        <span class="text-[10px] font-bold uppercase tracking-widest text-gray-400">Customer
                            Signature</span>
                    </div>
                    <div class="border-b border-black pt-8">
                        <span class="text-[10px] font-bold uppercase tracking-widest text-gray-400">Driver
                            Signature</span>
                    </div>
                    <div class="flex items-end gap-2">
                        <div class="flex-grow border-b border-black pt-8">
                            <span class="text-[10px] font-bold uppercase tracking-widest text-gray-400">Delivered
                                To</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Footer Actions -->
            <div class="mt-8 pt-6 border-t border-gray-200 flex justify-between items-center print:hidden">
                <button onclick="downloadTowTicket()"
                    class="text-blue-600 hover:text-blue-800 text-sm font-medium flex items-center gap-1">
                    Download PDF
                    <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                        <polyline points="7 10 12 15 17 10"></polyline>
                        <line x1="12" y1="15" x2="12" y2="3"></line>
                    </svg>
                </button>
                <div class="flex gap-2">
                    <button onclick="printTowTicket()" class="btn btn-sm btn-primary flex items-center gap-2">
                        <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none"
                            stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <polyline points="6 9 6 2 18 2 18 9"></polyline>
                            <path d="M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2"></path>
                            <rect x="6" y="14" width="12" height="8"></rect>
                        </svg>
                        Print Ticket
                    </button>
                </div>
            </div>

        </div>
    </main>

    <script src="../../js/mobile-nav.js"></script>
    <script>
        // Init Logic
        document.addEventListener('DOMContentLoaded', () => {
            const date = new Date();
            const id = Math.floor(Math.random() * 9000) + 1000;
            document.querySelector('.param-ticket-id').innerText = id;
            document.getElementById('tt-date').value = date.toLocaleDateString();

            initStorageDates();
            populateFromStorage();
        });


        // Toggle Button Logic
        function toggleBtn(btn) {
            // Check if it's a radio-style group (like agencies)
            const group = btn.dataset.group;
            if (group) {
                // Deselect others in group
                document.querySelectorAll(`.toggle-btn[data-group="${group}"]`).forEach(b => {
                    if (b !== btn) b.classList.remove('active');
                });
            }

            btn.classList.toggle('active');

            // Handle "Other" input visibility
            if (btn.dataset.value === 'Other') {
                const input = document.getElementById('other-agency-input');
                if (btn.classList.contains('active')) {
                    input.classList.remove('hidden');
                    input.focus();
                } else {
                    input.classList.add('hidden');
                }
            } else if (group === 'agency') {
                // Hide "Other" input if switching to another agency
                document.getElementById('other-agency-input').classList.add('hidden');
            }

            // Agency Price Logic
            if (group === 'agency' && btn.classList.contains('active')) {
                const val = btn.dataset.value;
                const baseInput = document.getElementById('tt-fee-base');
                const adminInput = document.getElementById('tt-fee-admin');

                if (val === 'Hawkins' || val === 'KPD') {
                    baseInput.value = 225;
                    adminInput.value = 175;
                } else if (val === 'THP') {
                    baseInput.value = 375;
                    adminInput.value = 175;
                }
                // Trigger calc
                calcTicketTotal();
            }
        }

        function updateStorageDays() {
            const startVal = document.getElementById('tt-store-start').value;
            const endVal = document.getElementById('tt-store-end').value;

            if (startVal && endVal) {
                const start = new Date(startVal);
                const end = new Date(endVal);

                // Diff in milliseconds
                const diffTime = Math.abs(end - start);
                // Diff in days (rounded up to next full day as standard practice, or just pure math)
                // "Tracks the days". Usually any part of a day is a day, or 24h blocks.
                // We'll use Math.ceil for full days logic.
                const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));

                // Ensure at least 1 day if dates are same or valid
                document.getElementById('tt-store-days').value = diffDays > 0 ? diffDays : 0; // Use 0 if same time or negative? Actually usually min 1 day charge if stored?
                // Letting user override means we just set it here.
                calcTicketTotal();
            }
        }

        function initStorageDates() {
            const now = new Date();

            // Format for datetime-local: YYYY-MM-DDTHH:mm
            const toLocalISO = (date) => {
                const offset = date.getTimezoneOffset() * 60000; // offset in milliseconds
                const localISOTime = (new Date(date - offset)).toISOString().slice(0, 16);
                return localISOTime;
            };

            document.getElementById('tt-store-end').value = toLocalISO(now);
            // Default start to now as well? Or leave blank? User needs to set In selection.
            // Let's leave start blank so they pick it, or default to now.
            document.getElementById('tt-store-start').value = toLocalISO(now);
        }

        // Try to read query params or local storage from calculator if we want to be fancy
        function populateFromStorage() {
            // For now just basic defaults
        }

        function calcTicketTotal() {
            // Sum Fees
            const feeIds = ['tt-fee-base', 'tt-fee-winch', 'tt-fee-clean', 'tt-fee-admin', 'tt-fee-labor', 'tt-fee-mileage', 'tt-fee-gate', 'tt-fee-misc'];

            let towTotal = 0;
            feeIds.forEach(id => {
                towTotal += parseFloat(document.getElementById(id).value) || 0;
            });

            document.getElementById('display-tow-total').innerText = '$' + towTotal.toFixed(2);


            // Storage
            let storeRate = 0;
            const rateEls = document.getElementsByName('store-rate');
            for (let el of rateEls) { if (el.checked) storeRate = parseFloat(el.value); }

            const days = parseFloat(document.getElementById('tt-store-days').value) || 0;
            const storeSubtotal = storeRate * days;
            const storeTax = storeSubtotal * 0.035;
            const storeTotal = storeSubtotal + storeTax;

            document.getElementById('display-store-subtotal').innerText = '$' + storeSubtotal.toFixed(2);
            document.getElementById('display-store-tax').innerText = '$' + storeTax.toFixed(2);
            document.getElementById('tt-total-storage').value = storeTotal.toFixed(2);

            const total = towTotal + storeTotal;
            document.getElementById('tt-total-due').value = '$' + total.toFixed(2);
        }

        function printTowTicket() {
            window.print();
        }

        function downloadTowTicket() {
            const element = document.getElementById('ticket-body');
            const id = document.querySelector('.param-ticket-id').innerText;

            const opt = {
                margin: 0,
                filename: `Treadz_TowTicket_${id}.pdf`,
                image: { type: 'jpeg', quality: 0.98 },
                html2canvas: { scale: 2, useCORS: true },
                jsPDF: { unit: 'in', format: [4.5, 11], orientation: 'portrait' }
            };

            // Temporary styles for PDF generation if needed
            html2pdf().set(opt).from(element).save();
        }

        // --- Autocomplete Logic ---
        function updateMakeModel() {
            const make = document.getElementById('tt-make').value;
            const model = document.getElementById('tt-model').value;
            document.getElementById('tt-make-model').value = (make + ' ' + model).trim();
        }

        function debounce(func, wait) {
            let timeout;
            return function (...args) {
                clearTimeout(timeout);
                timeout = setTimeout(() => func.apply(this, args), wait);
            };
        }

        async function fetchSuggestions(text) {
            const url = `https://geocode.arcgis.com/arcgis/rest/services/World/GeocodeServer/suggest?text=${encodeURIComponent(text)}&f=json&maxSuggestions=5`;
            try {
                const response = await fetch(url);
                const data = await response.json();
                return data.suggestions || [];
            } catch (e) {
                console.error("Autocomplete error:", e);
                return [];
            }
        }

        function setupAutocomplete(inputId, containerId) {
            const input = document.getElementById(inputId);
            const container = document.getElementById(containerId);

            const handleInput = debounce(async (e) => {
                const text = e.target.value;
                if (!text || text.length < 3) {
                    container.classList.add('hidden');
                    return;
                }
                const suggestions = await fetchSuggestions(text);

                container.innerHTML = '';
                if (suggestions.length > 0) {
                    suggestions.forEach(s => {
                        const li = document.createElement('li');
                        li.className = "px-4 py-2 hover:bg-blue-50 cursor-pointer text-sm text-gray-700 border-b last:border-0 border-gray-100";
                        li.innerText = s.text;
                        li.onclick = () => {
                            input.value = s.text;
                            container.classList.add('hidden');
                        };
                        container.appendChild(li);
                    });
                    container.classList.remove('hidden');
                } else {
                    container.classList.add('hidden');
                }
            }, 300);

            input.addEventListener('input', handleInput);

            // Close on click outside
            document.addEventListener('click', (e) => {
                if (!input.contains(e.target) && !container.contains(e.target)) {
                    container.classList.add('hidden');
                }
            });
        }

        // Initialize Autocomplete
        setupAutocomplete('tt-address', 'address-suggestions');
        setupAutocomplete('tt-location', 'location-suggestions');
    </script>
</body>

</html>